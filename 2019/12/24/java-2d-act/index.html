<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Java横板小游戏 - Addendum</title>


    <meta name="description" content="一个类似超级马里奥兄弟的ACT游戏，通过Java实现。 下载试玩~">
<meta property="og:type" content="article">
<meta property="og:title" content="Java横板小游戏">
<meta property="og:url" content="http://www.zanple.top/2019/12/24/java-2d-act/index.html">
<meta property="og:site_name" content="Addendum">
<meta property="og:description" content="一个类似超级马里奥兄弟的ACT游戏，通过Java实现。 下载试玩~">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.zanple.top/gallery/java-2d-act.png">
<meta property="article:published_time" content="2019-12-24T14:30:04.000Z">
<meta property="article:modified_time" content="2020-03-31T08:39:18.070Z">
<meta property="article:author" content="Zanple">
<meta property="article:tag" content="游戏">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.zanple.top/gallery/java-2d-act.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="Addendum" type="application/atom+xml">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Java横板小游戏" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ZanpleLee/">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/gallery/java-2d-act.png" alt="Java横板小游戏">
        </span>
    </div>
    
    <div class="card-content article ">
            <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
                    
                        <i class="fas fa-angle-double-right"></i>Java横板小游戏
                    
                </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                    <time class="level-item has-text-grey" datetime="2019-12-24T14:30:04.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2019-12-24</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-03-31T08:39:18.070Z"><i class="far fa-calendar-check">&nbsp;</i>2020-03-31</time>
                
                
                <div class="level-item">
                        <i class="far fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/%E6%B8%B8%E6%88%8F/">游戏</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                        <i class="far fa-clock"></i>&nbsp;
                    
                    
                    1 小时 读完 (大约 7828 个字)
                </span>
                
                
            </div>
        </div>
        
        <div class="content">
            <blockquote>
<p>一个类似超级马里奥兄弟的ACT游戏，通过Java实现。</p>
<p><a href="Java-Game.jar">下载试玩~</a><a id="more"></a></p>
</blockquote>
<h1 id="1-游戏设计"><a href="#1-游戏设计" class="headerlink" title="1. 游戏设计"></a>1. 游戏设计</h1><h2 id="1-1-游戏规则"><a href="#1-1-游戏规则" class="headerlink" title="1.1 游戏规则"></a>1.1 游戏规则</h2><p>玩家初始的生命值为<code>5</code>，生命值耗尽则游戏结束。游戏为单向走动，无法后退，消灭敌人达到<code>500分</code>即可通关。其中，踩死敌人<code>+100分</code>，射击击杀敌人<code>+50分</code>。若玩家角色在游戏过程中跌入悬崖，则消耗所有生命值。玩家角色在游戏中通过各类道具可获得特殊功能：红心增加<code>1</code>个生命值，守护天使给予玩家<code>5秒</code>的无敌时间，跳跳靴提高玩家的跳跃高度。</p>
<h2 id="1-2-游戏程序流程图"><a href="#1-2-游戏程序流程图" class="headerlink" title="1.2 游戏程序流程图"></a>1.2 游戏程序流程图</h2><div align=center>

<p><img src="clip_image002.png" alt="游戏程序流程图"></p>
</div>

<h2 id="1-3-类设计"><a href="#1-3-类设计" class="headerlink" title="1.3 类设计"></a>1.3 类设计</h2><div align=center>

<p><img src="clip_image002-1585407131127.png" alt="游戏类关系图"></p>
</div>

<h2 id="1-4-模块设计"><a href="#1-4-模块设计" class="headerlink" title="1.4 模块设计"></a>1.4 模块设计</h2><div align=center>

<p><img src="clip_image002-1585407149843.png" alt="游戏模块功能图"></p>
</div>

<h3 id="1-4-1-游戏精灵模块"><a href="#1-4-1-游戏精灵模块" class="headerlink" title="1.4.1 游戏精灵模块"></a>1.4.1 游戏精灵模块</h3><p>此模块可以分为玩家角色、电脑角色和道具。玩家角色可进行行走、跳跃、踩死敌人、射击敌人的操作，并有生命值的显示；电脑角色可以在一定的范围内追逐玩家；道具则分为增加生命值、增加跳跃高度、无敌状态的道具。</p>
<h3 id="1-4-2-地图模块"><a href="#1-4-2-地图模块" class="headerlink" title="1.4.2 地图模块"></a>1.4.2 地图模块</h3><p>地图模块分为卷轴模块和砖块模块，卷轴模块将图片的循环单向填充到游戏窗口；砖块模块根据游戏地图将对应的砖块绘制到游戏窗口。</p>
<h3 id="1-4-3-音乐音效模块"><a href="#1-4-3-音乐音效模块" class="headerlink" title="1.4.3 音乐音效模块"></a>1.4.3 音乐音效模块</h3><p>游戏背景音乐由音乐模块完成，音效音乐由音效模块完成。</p>
<h1 id="2-详细设计"><a href="#2-详细设计" class="headerlink" title="2. 详细设计"></a>2. 详细设计</h1><h2 id="2-1-卷轴图像"><a href="#2-1-卷轴图像" class="headerlink" title="2.1 卷轴图像"></a>2.1 卷轴图像</h2><h3 id="2-1-1卷轴的滚动显示"><a href="#2-1-1卷轴的滚动显示" class="headerlink" title="2.1.1卷轴的滚动显示"></a>2.1.1卷轴的滚动显示</h3><p>定义一个变量xImHead用来指示图像左边缘与窗口左边缘的相对位置，初值为零，当该值大于零时表示图像左边缘在窗口右侧，小于零时则表示在窗口左侧。根据图像是否滚动填充游戏窗口。</p>
<div align=center>

<p><img src="clip_image002.jpg" alt="图像没有滚动"></p>
<p><img src="clip_image002-1585407783032.jpg" alt="图像开始向右滚动"></p>
<p><img src="clip_image002-1585407789297.jpg" alt="图像继续向右滚动"></p>
</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span> </span>&#123;              <span class="comment">//绘制卷轴型图像</span></span><br><span class="line">   <span class="keyword">if</span> (xImHead == <span class="number">0</span>) &#123;                      <span class="comment">//情形1</span></span><br><span class="line">      drawRibbon(g, bim, <span class="number">0</span>, pWidth, <span class="number">0</span>, pWidth);</span><br><span class="line">   &#125; </span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> ((xImHead &gt; <span class="number">0</span>) &amp;&amp; (xImHead &lt; pWidth)) &#123;             <span class="comment">//情形2</span></span><br><span class="line">      drawRibbon(g, bim, <span class="number">0</span>, xImHead, width - xImHead, width);</span><br><span class="line">      drawRibbon(g, bim, xImHead, pWidth, <span class="number">0</span>, pWidth - xImHead);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> (xImHead &gt;= pWidth) &#123;                       <span class="comment">//情形3</span></span><br><span class="line">      drawRibbon(g, bim, <span class="number">0</span>, pWidth, width - xImHead, width - xImHead + pWidth);</span><br><span class="line">   &#125; </span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> ((xImHead &lt; <span class="number">0</span>) &amp;&amp; (xImHead &gt;= pWidth - width)) &#123;   <span class="comment">//情形4</span></span><br><span class="line">      drawRibbon(g, bim, <span class="number">0</span>, pWidth, -xImHead, pWidth - xImHead);</span><br><span class="line">   &#125; </span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> (xImHead &lt; pWidth - width) &#123;                  <span class="comment">//情形5</span></span><br><span class="line">      drawRibbon(g, bim, <span class="number">0</span>, width + xImHead, -xImHead, width);</span><br><span class="line">      drawRibbon(g, bim, width + xImHead, pWidth, <span class="number">0</span>, pWidth - width - xImHead);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2卷轴的单向滚动"><a href="#2-1-2卷轴的单向滚动" class="headerlink" title="2.1.2卷轴的单向滚动"></a>2.1.2卷轴的单向滚动</h3><p>让游戏场景只能从左到右单向滚动（类似超级玛丽）,在玩家向左运动时停止卷轴背景的滚动，并保证玩家角色不会走出左边屏幕边缘。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> RUNLT:							<span class="comment">//考虑玩家向左运动的情况</span></span><br><span class="line"><span class="comment">//若玩家向左移动到屏幕的最左端</span></span><br><span class="line"><span class="keyword">if</span> (gameWorld.getOffsetX() &lt;= gameWorld.getOffsetX()  || (locX &gt; GamePanel.WIDTH / <span class="number">2</span>)) &#123;</span><br><span class="line">		<span class="keyword">if</span>(locX&gt;<span class="number">0</span>) &#123;					<span class="comment">//在屏幕范围内</span></span><br><span class="line">			setDX(<span class="number">5</span>);</span><br><span class="line">			locX -= dx;                 <span class="comment">//减少玩家的横坐标值</span></span><br><span class="line">			gameWorld.canScroll = <span class="keyword">false</span>;<span class="comment">//停止卷轴背景滚动</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-3载入地图"><a href="#2-1-3载入地图" class="headerlink" title="2.1.3载入地图"></a>2.1.3载入地图</h3><p>定义TileMap类用来表示游戏中所有砖块型图像的集合，并统一地对其进行坐标更新和图像绘制。同时定义一个二维的BufferedImage类型数组tiles[][]用来存放各个砖块型图像，该数组的大小由砖块地图文件中字符的行数和列数确定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取砖块地图文件信息并生成TileMap对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TileMap <span class="title">loadTileMap</span><span class="params">(String filename)</span> </span>&#123;</span><br><span class="line">        ArrayList lines = <span class="keyword">new</span> ArrayList();          <span class="comment">//存放tileMap中每一行的字符信息</span></span><br><span class="line">        <span class="keyword">int</span> width = <span class="number">0</span>;                              <span class="comment">//tileMap的宽度</span></span><br><span class="line">        <span class="keyword">int</span> height = <span class="number">0</span>;                             <span class="comment">//tileMap的高度</span></span><br><span class="line">        <span class="comment">//逐行地读取砖块地图中的内容</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//用字符输入流对象reader来载入砖块地图中的全部</span></span><br><span class="line">        	BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(getClass().getResourceAsStream(filename)));</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                String line = reader.readLine();             <span class="comment">//读取一行字符串</span></span><br><span class="line">                <span class="keyword">if</span> (line == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!line.startsWith(<span class="string">"#"</span>)) &#123;</span><br><span class="line">                    lines.add(line);                        <span class="comment">//将字符串对象Line加入数组列表中</span></span><br><span class="line">                    width = Math.max(width, line.length()); <span class="comment">//获取砖块地图的宽度</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        height = lines.size();                              <span class="comment">//获取砖块地图的高度</span></span><br><span class="line">        TileMap newMap = <span class="keyword">new</span> TileMap(width, height);        <span class="comment">//建立TileMap对象</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;                  <span class="comment">//循环地读取砖块地图文件中的所有字符，并分别进行处理</span></span><br><span class="line">            String line = (String) lines.get(y);            <span class="comment">//读取某行字符信息</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; line.length(); x++) &#123;</span><br><span class="line">                <span class="keyword">char</span> ch = line.charAt(x);                   <span class="comment">//对不同字符类型进行判断</span></span><br><span class="line">                <span class="keyword">int</span> tile = ch - <span class="string">'A'</span>;</span><br><span class="line">                <span class="keyword">if</span> (tile &gt;= <span class="number">0</span> &amp;&amp; tile &lt; tiles.size()) &#123;     <span class="comment">//若为字母，则载入相应的砖块型图像</span></span><br><span class="line">                    newMap.setTile(x, y, (BufferedImage) tiles.get(tile));</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'0'</span>) == <span class="number">0</span>) &#123;               <span class="comment">//若读取数字字符则载入对应敌人</span></span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.ANPC ,<span class="string">"npc0"</span>, <span class="number">4</span>, <span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);                       <span class="comment">//加入数组列表</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'1'</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.ANPC ,<span class="string">"npc1"</span>, <span class="number">4</span>, <span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'2'</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.ANPC ,<span class="string">"npc2"</span>, <span class="number">6</span>, <span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'3'</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.ANPC ,<span class="string">"npc3"</span>, <span class="number">6</span>, <span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'!'</span>) == <span class="number">0</span>) &#123;             <span class="comment">//若为字符，则载入对应道具</span></span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.SNPC ,<span class="string">"heart"</span>, <span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);                   <span class="comment">//加入数组列表</span></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'*'</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.SNPC ,<span class="string">"star"</span>,<span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);                   <span class="comment">//加入数组列表</span></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> ((ch - <span class="string">'?'</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    EnemyProp eny = <span class="keyword">new</span> EnemyProp(x * TILE_SIZE, y * TILE_SIZE, EnemyProp.SNPC ,<span class="string">"power"</span>,<span class="keyword">this</span>);</span><br><span class="line">                    sprites.add(eny);                   <span class="comment">//加入数组列表</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newMap;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-4垂直滚动场景"><a href="#2-1-4垂直滚动场景" class="headerlink" title="2.1.4垂直滚动场景"></a>2.1.4垂直滚动场景</h3><p>若玩家跳跃后站在了砖块上，同时其图像的底端超出了游戏窗口的上边缘，则开始向上滚动砖块地图；若玩家下落时掉出了游戏窗口下边缘（但没有掉出砖块地图），则开始向下滚动砖块地图。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> UpScrollY:										<span class="comment">//考虑向上滚动砖块地图的情况</span></span><br><span class="line">			gameP.removeKeyListener(gameP);					<span class="comment">//移除键盘按键事件监听</span></span><br><span class="line">			<span class="keyword">if</span> (scrollCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//若滚动计数值大于0，则停止背景的水平滚动和玩家的水平移动</span></span><br><span class="line">				gameWorld.canMoveLeft = <span class="keyword">false</span>;</span><br><span class="line">				gameWorld.canMoveRight = <span class="keyword">false</span>;</span><br><span class="line">				<span class="keyword">if</span> (runningState == RUNRT) &#123;</span><br><span class="line">					runningState = STDRT;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (runningState == RUNLT) &#123;</span><br><span class="line">					runningState = STDLT;</span><br><span class="line">				&#125;</span><br><span class="line">				scrollCount -= <span class="number">5</span>;							<span class="comment">//减少滚动计数值</span></span><br><span class="line">				offsetY -= <span class="number">5</span>;								<span class="comment">//减少垂直方向偏移值</span></span><br><span class="line">				locY += <span class="number">5</span>;									<span class="comment">//增加玩家纵坐标值</span></span><br><span class="line">				gameWorld.setOffsetY(offsetY);				<span class="comment">//更新游戏世界的垂直偏移值</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;										<span class="comment">//若滚动计数值小于等于0，则</span></span><br><span class="line">				scrollCount = GamePanel.HEIGHT;				<span class="comment">//重置滚动计数值为窗口的高度</span></span><br><span class="line">				gameP.addKeyListener(gameP);				<span class="comment">//添加键盘按键事件监听</span></span><br><span class="line">				gameP.leftPressed = <span class="keyword">false</span>;</span><br><span class="line">				gameP.rightPressed = <span class="keyword">false</span>;</span><br><span class="line">				changeState(MOVE);							<span class="comment">//将玩家状态切换为移动状态</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> DownScrollY:									<span class="comment">//考虑向下滚动砖块地图的情况</span></span><br><span class="line">			gameP.removeKeyListener(gameP);					<span class="comment">//移除键盘按键事件监听</span></span><br><span class="line">			<span class="keyword">if</span> (scrollCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//若滚动计数值大于0，则停止背景的水平滚动和玩家的水平移动</span></span><br><span class="line">				gameWorld.canMoveLeft = <span class="keyword">false</span>;</span><br><span class="line">				gameWorld.canMoveRight = <span class="keyword">false</span>;</span><br><span class="line">				<span class="keyword">if</span> (runningState == RUNRT) &#123;</span><br><span class="line">					runningState = STDRT;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (runningState == RUNLT) &#123;</span><br><span class="line">					runningState = STDLT;</span><br><span class="line">				&#125;</span><br><span class="line">				scrollCount -= <span class="number">5</span>;							<span class="comment">//减少滚动计数值</span></span><br><span class="line">				offsetY += <span class="number">5</span>;								<span class="comment">//增加垂直方向偏移值</span></span><br><span class="line">				locY -= <span class="number">5</span>;									<span class="comment">//减少玩家纵坐标值</span></span><br><span class="line">				gameWorld.setOffsetY(offsetY);				<span class="comment">//更新游戏世界的垂直偏移值</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//若滚动计数值小于等于0，则</span></span><br><span class="line">				scrollCount = GamePanel.HEIGHT;				<span class="comment">//重置滚动计数值为窗口的高度</span></span><br><span class="line">				gameP.addKeyListener(gameP);				<span class="comment">//添加键盘按键事件监听</span></span><br><span class="line">				gameP.leftPressed = <span class="keyword">false</span>;</span><br><span class="line">				gameP.rightPressed = <span class="keyword">false</span>;</span><br><span class="line">				changeState(MOVE);							<span class="comment">//将玩家状态切换到移动状态</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//垂直方向上的角色坐标更新</span></span><br><span class="line">		locY += dy;</span><br><span class="line">		<span class="comment">//水平方向上场景滚动，角色坐标不变</span></span><br><span class="line">		<span class="keyword">if</span> (locY + gameWorld.getOffsetY() &gt; gameWorld.tMap.getHeight()</span><br><span class="line">				* gameWorld.tMap.TILE_SIZE)			<span class="comment">//若玩家角色掉出了砖块地图的下边缘，则游戏结束</span></span><br><span class="line">			changeState(DISMISS);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (locY &gt; GamePanel.HEIGHT)			<span class="comment">//否则，若玩家角色掉出了游戏窗口的下边缘，则开始向下滚动砖块地图</span></span><br><span class="line">			changeState(DownScrollY);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//更新玩家角色移动的精灵动画图像</span></span><br><span class="line">		<span class="keyword">switch</span> (runningState) &#123;</span><br><span class="line">		<span class="keyword">case</span> RUNRT:</span><br><span class="line">			animRight.updateImage();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> RUNLT:</span><br><span class="line">			animLeft.updateImage();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//玩家角色与砖块图像在垂直方向的碰撞检测</span></span><br><span class="line">		<span class="keyword">if</span> (gameWorld.worldCollisionVertical(<span class="keyword">this</span>, thisPosition(),nextPosition(), offsetY)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dy &gt; <span class="number">0</span>) &#123;				<span class="comment">//若玩家角色处于下落过程中发生碰撞，则停止下落</span></span><br><span class="line">				onGround = <span class="keyword">true</span>;		<span class="comment">//玩家碰到地面</span></span><br><span class="line">				setDY(<span class="number">0</span>);				<span class="comment">//停止继续下落</span></span><br><span class="line">				<span class="keyword">if</span> (locY + <span class="keyword">this</span>.getHeight() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="comment">//若玩家角色图像的底端超过了游戏窗口的上边缘，则开始向上滚动砖块地图</span></span><br><span class="line">					changeState(UpScrollY);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (dy &lt; <span class="number">0</span>) &#123;			<span class="comment">//若是玩家处于跳起过程中发生碰撞</span></span><br><span class="line">			isJumping = <span class="keyword">false</span>;			<span class="comment">//角色开始转为下落</span></span><br><span class="line">			jumpSpeed = -INISPEED;		<span class="comment">//跳跃速度恢复到初始值</span></span><br><span class="line"></span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-精灵"><a href="#2-2-精灵" class="headerlink" title="2.2 精灵"></a>2.2 精灵</h2><h3 id="2-2-1精灵图像的绘制"><a href="#2-2-1精灵图像的绘制" class="headerlink" title="2.2.1精灵图像的绘制"></a>2.2.1精灵图像的绘制</h3><p>首先将精灵图像文件保存至BufferedImage对象bim中，然后建立BufferedImage数组ims用来存放各个精灵图像，并在循环语句中通过调用drawImage()方法将bim中的图像分割为相同尺寸的精灵图像。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BufferedImage[] setAnimImagesFromOneFile(String fnm, <span class="keyword">int</span> num) &#123;</span><br><span class="line">        BufferedImage bim = loadImage(fnm);                     <span class="comment">//读取名为fnm的图像文件</span></span><br><span class="line">        BufferedImage[] ims = <span class="keyword">new</span> BufferedImage[num];           <span class="comment">//存放各个精灵图像</span></span><br><span class="line">        <span class="keyword">int</span> imWidth = (<span class="keyword">int</span>) bim.getWidth() / num;               <span class="comment">//精灵图像的宽度</span></span><br><span class="line">        <span class="keyword">int</span> imHeight = bim.getHeight();                         <span class="comment">//精灵图像的高度</span></span><br><span class="line">        Graphics g;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">            ims[i]= <span class="keyword">new</span> BufferedImage(imWidth,imHeight,BufferedImage.TYPE_INT_ARGB);</span><br><span class="line">            g=ims[i].getGraphics();</span><br><span class="line">            g.drawImage(bim, <span class="number">0</span>, <span class="number">0</span>, imWidth, imHeight, i*imWidth,<span class="number">0</span>,(i*imWidth)+imWidth,imHeight, <span class="keyword">null</span>);</span><br><span class="line">            g.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ims;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-角色与场景的交互"><a href="#2-3-角色与场景的交互" class="headerlink" title="2.3 角色与场景的交互"></a>2.3 角色与场景的交互</h2><h3 id="2-3-1精灵图像的绘制"><a href="#2-3-1精灵图像的绘制" class="headerlink" title="2.3.1精灵图像的绘制"></a>2.3.1精灵图像的绘制</h3><p>玩家的起跳、下落、走到地图边缘或是屏幕边缘的移动变化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现玩家角色在活动态下的行为</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//判定玩家角色是否进行跳跃，并进行相应的坐标值更新</span></span><br><span class="line">		<span class="keyword">if</span> (!isJumping) &#123;					<span class="comment">//非挑起阶段做自由落体运动</span></span><br><span class="line">			dy += GRAVITY;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;							<span class="comment">//跳起阶段做减速直线运动</span></span><br><span class="line">			jumpSpeed += GRAVITY;</span><br><span class="line">			setDY(jumpSpeed);</span><br><span class="line">			onGround = <span class="keyword">false</span>;</span><br><span class="line">			<span class="keyword">if</span> (jumpSpeed &gt;= <span class="number">0</span>) &#123;			<span class="comment">//若是达到最高点</span></span><br><span class="line">				isJumping = <span class="keyword">false</span>;</span><br><span class="line">				jumpSpeed = -INISPEED;		<span class="comment">//跳跃速度的初始方向朝上</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//垂直方向上的角色坐标更新</span></span><br><span class="line">		locY += dy;</span><br><span class="line">		<span class="comment">//水平方向上场景滚动，角色坐标不变</span></span><br><span class="line">		<span class="keyword">if</span> (locY + gameWorld.getOffsetY() &gt; gameWorld.tMap.getHeight()</span><br><span class="line">				* gameWorld.tMap.TILE_SIZE)			<span class="comment">//若玩家角色掉出了砖块地图的下边缘，则游戏结束</span></span><br><span class="line">			changeState(DISMISS);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (locY &gt; GamePanel.HEIGHT)			<span class="comment">//否则，若玩家角色掉出了游戏窗口的下边缘，则开始向下滚动砖块地图</span></span><br><span class="line">			changeState(DownScrollY);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//更新玩家角色移动的精灵动画图像</span></span><br><span class="line">		<span class="keyword">switch</span> (runningState) &#123;</span><br><span class="line">		<span class="keyword">case</span> RUNRT:</span><br><span class="line">			animRight.updateImage();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> RUNLT:</span><br><span class="line">			animLeft.updateImage();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//玩家角色与砖块图像在垂直方向的碰撞检测</span></span><br><span class="line">		<span class="keyword">if</span> (gameWorld.worldCollisionVertical(<span class="keyword">this</span>, thisPosition(),nextPosition(), offsetY)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dy &gt; <span class="number">0</span>) &#123;				<span class="comment">//若玩家角色处于下落过程中发生碰撞，则停止下落</span></span><br><span class="line">				onGround = <span class="keyword">true</span>;		<span class="comment">//玩家碰到地面</span></span><br><span class="line">				setDY(<span class="number">0</span>);				<span class="comment">//停止继续下落</span></span><br><span class="line">				<span class="keyword">if</span> (locY + <span class="keyword">this</span>.getHeight() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="comment">//若玩家角色图像的底端超过了游戏窗口的上边缘，则开始向上滚动砖块地图</span></span><br><span class="line">					changeState(UpScrollY);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (dy &lt; <span class="number">0</span>) &#123;			<span class="comment">//若是玩家处于跳起过程中发生碰撞</span></span><br><span class="line">			isJumping = <span class="keyword">false</span>;			<span class="comment">//角色开始转为下落</span></span><br><span class="line">			jumpSpeed = -INISPEED;		<span class="comment">//跳跃速度恢复到初始值</span></span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//玩家角色与砖块图像在水平方向的碰撞检测</span></span><br><span class="line">		<span class="keyword">if</span> (gameWorld.worldCollisionHorizontal(<span class="keyword">this</span>, thisPosition(),nextPosition(), offsetX)) &#123;</span><br><span class="line">			gameWorld.canScroll = <span class="keyword">false</span>;		<span class="comment">//若发生碰撞则停止滚动场景</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;								<span class="comment">//若水平方向没有发生碰撞，则根据玩家角色当前运动方向进行判断</span></span><br><span class="line">			<span class="keyword">switch</span> (runningState) &#123;</span><br><span class="line">			<span class="keyword">case</span> RUNLT:							<span class="comment">//考虑玩家向左运动的情况</span></span><br><span class="line">				<span class="comment">//若玩家向左移动到屏幕的最左端</span></span><br><span class="line">				<span class="keyword">if</span> (gameWorld.getOffsetX() &lt;= gameWorld.getOffsetX()  || (locX &gt; GamePanel.WIDTH / <span class="number">2</span>)) &#123;</span><br><span class="line">					<span class="keyword">if</span>(locX&gt;<span class="number">0</span>) &#123;					<span class="comment">//在屏幕范围内</span></span><br><span class="line">						setDX(<span class="number">5</span>);</span><br><span class="line">						locX -= dx;                 <span class="comment">//减少玩家的横坐标值</span></span><br><span class="line">						gameWorld.canScroll = <span class="keyword">false</span>;<span class="comment">//停止卷轴背景滚动</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span></span><br><span class="line">					<span class="comment">//若玩家没有到达砖块地图的两端则让卷轴背景滚动起来</span></span><br><span class="line">					gameWorld.canScroll = <span class="keyword">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> RUNRT:							<span class="comment">//考虑玩家向右运动的情况</span></span><br><span class="line">				<span class="comment">//若玩家向右移动到砖块地图的最右端，或从砖块地图的最左端开始向右移动</span></span><br><span class="line">				<span class="keyword">if</span> (locX &lt; GamePanel.WIDTH / <span class="number">2</span></span><br><span class="line">						|| (gameWorld.getOffsetX() &gt;= (gameWorld.tMap.getWidth()</span><br><span class="line">								* gameWorld.tMap.TILE_SIZE - GamePanel.WIDTH))) &#123;</span><br><span class="line">					setDX(<span class="number">5</span>);</span><br><span class="line">					locX += dx;					<span class="comment">//增加玩家的横坐标值</span></span><br><span class="line">					gameWorld.canScroll = <span class="keyword">false</span>;<span class="comment">//停止卷轴背景滚动</span></span><br><span class="line">				&#125; <span class="keyword">else</span></span><br><span class="line">					<span class="comment">//若玩家没有到达砖块地图的两端则让卷轴背景滚动起来</span></span><br><span class="line">					gameWorld.canScroll = <span class="keyword">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2碰撞检测方法"><a href="#2-3-2碰撞检测方法" class="headerlink" title="2.3.2碰撞检测方法"></a>2.3.2碰撞检测方法</h3><p>checkTileCollision()方法实际判断的是角色与砖块图像图标是否发生了重叠，若是则返回碰撞的砖块图像坐标。由于判断的是运动中的角色，因此需要知道角色的当前位置坐标和下一帧的坐标。</p>
<div align=center>

<p><img src="clip_image002-1585407970339.jpg" alt="玩家角色与砖块型图像的碰撞检测"></p>
</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断角色是否与砖块型图像发生碰撞</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Point <span class="title">checkTileCollision</span><span class="params">(Sprite sprite,<span class="keyword">int</span> oldX, <span class="keyword">int</span> oldY, <span class="keyword">int</span> newX, <span class="keyword">int</span> newY)</span> </span>&#123;</span><br><span class="line">        Point pointCache = <span class="keyword">new</span> Point(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//划定参与碰撞检测的坐标范围</span></span><br><span class="line">        <span class="keyword">int</span> fromX = Math.min(oldX, newX);                   <span class="comment">//碰撞检测范围左上角的X坐标</span></span><br><span class="line">        <span class="keyword">int</span> fromY = Math.min(oldY, newY);                   <span class="comment">//碰撞检测范围左上角的Y坐标</span></span><br><span class="line">        <span class="keyword">int</span> toX = Math.max(oldX, newX);                     <span class="comment">//碰撞检测范围右下角的X坐标</span></span><br><span class="line">        <span class="keyword">int</span> toY = Math.max(oldY, newY);                     <span class="comment">//碰撞简称范围右下角的Y坐标</span></span><br><span class="line">        <span class="comment">//将程序窗口坐标转换为砖块型图像数组的下标，以便划定参与碰撞检测的砖块型图像的范围</span></span><br><span class="line">        <span class="keyword">int</span> fromTileX = tMap.pixelsToTiles(fromX);</span><br><span class="line">        <span class="keyword">int</span> fromTileY = tMap.pixelsToTiles(fromY);</span><br><span class="line">        <span class="keyword">int</span> toTileX = tMap.pixelsToTiles(toX + sprite.getWidth() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> toTileY = tMap.pixelsToTiles(toY + sprite.getHeight() - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//对划定范围内的砖块型图像逐个地进行碰撞检测</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = fromTileX; x &lt;= toTileX; x++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> y = fromTileY; y &lt;=toTileY; y++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (x &lt; <span class="number">0</span> || x &gt;= tMap.getWidth() || tMap.getTile(x, y) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//若发生了碰撞，则返回该砖块型图像的下标</span></span><br><span class="line">                    pointCache.setLocation(x, y);</span><br><span class="line">                    <span class="keyword">return</span> pointCache;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//若没有检测到碰撞，则返回空值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3水平方向的碰撞检测"><a href="#2-3-3水平方向的碰撞检测" class="headerlink" title="2.3.3水平方向的碰撞检测"></a>2.3.3水平方向的碰撞检测</h3><p>当调用checkTileCollision()方法判断发生碰撞后，检测角色对象中水平方向速度dx的值。若dx&lt;0，则表示角色向左运动时发生了碰撞；若dx&gt;0，则表示角色向右运动时发生了碰撞。发生碰撞后的处理是设置角色对象在水平方向上紧贴着砖块对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进行水平方向的碰撞检测</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">worldCollisionHorizontal</span><span class="params">(Sprite sprite, Point thisPos, Point nextPos, <span class="keyword">int</span> offSetX)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//划定碰撞检测范围</span></span><br><span class="line">        <span class="keyword">int</span> dx = sprite.getDX();</span><br><span class="line">        <span class="keyword">int</span> oldX = thisPos.x;</span><br><span class="line">        <span class="keyword">int</span> newX = nextPos.x;</span><br><span class="line">        <span class="keyword">int</span> oldY = thisPos.y;</span><br><span class="line">        <span class="keyword">int</span> newY = oldY;</span><br><span class="line">        <span class="comment">//获取发生了碰撞的砖块型图像的下标</span></span><br><span class="line">        Point tile = checkTileCollision(sprite, oldX, oldY, newX, newY);</span><br><span class="line">        <span class="keyword">if</span> (tile == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//调整角色横坐标值，使得角色在水平方向上紧贴着砖块型图像</span></span><br><span class="line">            <span class="keyword">if</span> (dx &gt; <span class="number">0</span>) &#123;           <span class="comment">//若角色朝右移动</span></span><br><span class="line">                sprite.setX(tMap.tilesToPixels(tile.x) - offSetX - sprite.getWidth());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dx &lt; <span class="number">0</span>) &#123;    <span class="comment">//若角色朝左移动</span></span><br><span class="line">                sprite.setX(tMap.tilesToPixels(tile.x + <span class="number">1</span>) - offSetX);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4垂直方向的碰撞检测"><a href="#2-3-4垂直方向的碰撞检测" class="headerlink" title="2.3.4垂直方向的碰撞检测"></a>2.3.4垂直方向的碰撞检测</h3><p>当调用checkTileCollision()方法判断发生碰撞后，检测角色对象中水平方向速度dy的值。若dy&lt;0，则表示角色下落过程中发生了碰撞；若dy&gt;0，则表示角色挑起过程中发生了碰撞。若发生了垂直方向的碰撞，则设置角色对象在垂直方向上紧贴着砖块型图像，当dy&lt;0时应该停止角色继续上升，并将其值设为0使其开始下落。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进行垂直方向的碰撞检测</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">worldCollisionVertical</span><span class="params">(Sprite sprite, Point thisPos, Point nextPos, <span class="keyword">int</span> offSetY)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//划定碰撞检测范围</span></span><br><span class="line">        <span class="keyword">int</span> dy = sprite.getDY();</span><br><span class="line">        <span class="keyword">int</span> oldY = thisPos.y;</span><br><span class="line">        <span class="keyword">int</span> newY = nextPos.y;</span><br><span class="line">        <span class="keyword">int</span> oldX = thisPos.x;</span><br><span class="line">        <span class="keyword">int</span> newX = oldX;</span><br><span class="line">        <span class="comment">//获取发生了碰撞的砖块型图像的下标</span></span><br><span class="line">        Point tile = checkTileCollision(sprite, oldX, oldY, newX, newY);</span><br><span class="line">        <span class="keyword">if</span> (tile == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="comment">//调整角色纵坐标值，使得角色在垂直方向上紧贴着砖块型图像</span></span><br><span class="line">            <span class="keyword">if</span> (dy &gt; <span class="number">0</span>) &#123;           <span class="comment">//若角色处于下落过程中</span></span><br><span class="line">                sprite.setY(tMap.tilesToPixels(tile.y) - offSetY - sprite.getHeight());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dy &lt; <span class="number">0</span>) &#123;    <span class="comment">//若角色处于跳起过程中</span></span><br><span class="line">                sprite.setY(tMap.tilesToPixels(tile.y + <span class="number">1</span>) - offSetY);</span><br><span class="line">                sprite.setDY(<span class="number">0</span>);    <span class="comment">//角色停止继续上升</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-5精灵角色碰撞检测的方法"><a href="#2-3-5精灵角色碰撞检测的方法" class="headerlink" title="2.3.5精灵角色碰撞检测的方法"></a>2.3.5精灵角色碰撞检测的方法</h3><p>碰撞检测的算法类似于《打砖块》游戏中判定小球和砖块是否发生碰撞的算法，都是通过判断碰撞双方的边界是否发生了重叠。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检测精灵角色间的碰撞</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">spriteCollision</span><span class="params">(Sprite s1, Sprite s2, <span class="keyword">boolean</span> isPlayer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// if the Sprites are the same, return false</span></span><br><span class="line">        <span class="keyword">if</span> (s1 == s2) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取参与检测双方的横坐标和纵坐标</span></span><br><span class="line">        <span class="keyword">int</span> s1x, s1y, s2x, s2y;</span><br><span class="line">        s1x = s1.getX();</span><br><span class="line">        s2x = s2.getX();</span><br><span class="line">        s1y = s1.getY();</span><br><span class="line">        s2y = s2.getY();</span><br><span class="line">        <span class="comment">//若有玩家角色参与碰撞检测，则将其坐标转换为游戏世界坐标</span></span><br><span class="line">        <span class="keyword">if</span> (isPlayer) &#123;</span><br><span class="line">            s1x += getOffsetX();</span><br><span class="line">            s1y += getOffsetY();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判定双方的边界是否发生重叠，并返回判定结果</span></span><br><span class="line">        <span class="keyword">return</span> (s1x &lt; s2x + s2.getWidth() &amp;&amp;</span><br><span class="line">                s2x &lt; s1x + s1.getWidth() &amp;&amp;</span><br><span class="line">                s1y &lt; s2y + s2.getHeight() &amp;&amp;</span><br><span class="line">                s2y &lt; s1y + s1.getHeight());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-6玩家角色跳起来“踩”电脑角色"><a href="#2-3-6玩家角色跳起来“踩”电脑角色" class="headerlink" title="2.3.6玩家角色跳起来“踩”电脑角色"></a>2.3.6玩家角色跳起来“踩”电脑角色</h3><p>在碰撞检测方面，需要判定玩家角色是否在跳起后下落的过程中与电脑角色发生了碰撞；在碰撞处理方面，需要让电脑角色被“踩”到后从屏幕上消失。为了体现游戏的真实性，还需要加入一个掉落的过程，即电脑角色被“踩”到后垂直地从程序窗口下方掉落，直至其图像超出窗口下边界后消失。</p>
<div align=center>

<p><img src="clip_image002-1585408083751.jpg" alt="电脑角色的有限状态机"></p>
</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((eny.npcType == EnemyProp.ANPC) &amp;&amp; (man.state != Player.UNATTACK)) &#123;<span class="comment">//若玩家碰到了敌人，则进行相应处理</span></span><br><span class="line">					sound.loadSound(<span class="string">"Sounds/collision.wav"</span>);</span><br><span class="line">					sound.playSound();</span><br><span class="line">					<span class="keyword">if</span> ((man.dy &gt; <span class="number">0</span>)			<span class="comment">//若玩家角色处于掉落过程中，改变电脑角色的状态为掉落态</span></span><br><span class="line">							&amp;&amp; (man.locY &lt; (eny.locY - gameWorld.getOffsetY()))) &#123;</span><br><span class="line">						eny.changeState(Sprite.ISHITTED);</span><br><span class="line"><span class="comment">//						gameWorld.anpcNum--;</span></span><br><span class="line">						score += <span class="number">100</span>;			<span class="comment">//玩家角色踩到电脑角色后加100分</span></span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						man.changeState(Sprite.ISHITTED);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现电脑角色在掉落态的行为</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drop</span><span class="params">()</span> </span>&#123;        <span class="comment">//若电脑角色超出了窗口下边界则改变其状态为消失态</span></span><br><span class="line">		<span class="keyword">if</span> (locY - gameWorld.getOffsetY() &gt; GamePanel.HEIGHT) &#123;</span><br><span class="line">			changeState(DISMISS);</span><br><span class="line">		&#125;</span><br><span class="line">		setDY(dy + GRAVITY);	<span class="comment">//增加垂直速度值</span></span><br><span class="line">		locY += dy;				<span class="comment">//增加垂直坐标值</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-7玩家角色发射子弹攻击电脑角色"><a href="#2-3-7玩家角色发射子弹攻击电脑角色" class="headerlink" title="2.3.7玩家角色发射子弹攻击电脑角色"></a>2.3.7玩家角色发射子弹攻击电脑角色</h3><p>当游戏者按下“Ctrl”键时玩家角色发射子弹，并让子弹沿水平方向做匀速直线运动，当子弹超出程序窗口范围或击中电脑角色后消失。</p>
<div align=center>

<p><img src="clip_image002-1585408139244.jpg" alt="子弹的有限状态机模型"></p>
</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkShooting</span><span class="params">()</span> </span>&#123;												<span class="comment">//检测子弹对象与电脑角色的碰撞检测</span></span><br><span class="line">		<span class="comment">// man.move() must be first operated!</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bullets.size(); i++) &#123;</span><br><span class="line">			Bullet bul = (Bullet) bullets.get(i);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; gameWorld.getSprites().size(); j++) &#123;  			<span class="comment">//将子弹对象与所有电脑角色逐个进行碰撞检测</span></span><br><span class="line">				EnemyProp eny = (EnemyProp) gameWorld.getSprites().get(j);</span><br><span class="line">				<span class="keyword">if</span> (gameWorld.spriteCollision(bul, eny, <span class="keyword">true</span>)</span><br><span class="line">						&amp;&amp; (eny.npcType == EnemyProp.ANPC)</span><br><span class="line">						&amp;&amp; (eny.state != Sprite.ISHITTED) &amp;&amp; bul.isActive()) &#123;</span><br><span class="line">					sound.loadSound(<span class="string">"Sounds/collision.wav"</span>);			<span class="comment">//载入子弹击中目标的音效</span></span><br><span class="line">					sound.playSound();											<span class="comment">//播放音效</span></span><br><span class="line">					eny.changeState(Sprite.ISHITTED);							<span class="comment">//改变电脑角色的状态</span></span><br><span class="line"><span class="comment">//					gameWorld.anpcNum--;</span></span><br><span class="line">					bul.changeState(Sprite.DISMISS);							<span class="comment">//改变子弹角色的状态</span></span><br><span class="line">					score += <span class="number">50</span>;												<span class="comment">//玩家角色发射子弹击中电脑角色加50分</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			bul.update();														<span class="comment">//若无碰撞发生则更新子弹坐标值</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-8电脑角色追逐玩家角色"><a href="#2-3-8电脑角色追逐玩家角色" class="headerlink" title="2.3.8电脑角色追逐玩家角色"></a>2.3.8电脑角色追逐玩家角色</h3><p>当电脑角色“发现”玩家角色后便朝着玩家角色的方向移动，而当玩家角色离开电脑角色的视野后停止追逐。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判定电脑角色是否“发现”了玩家角色</span></span><br><span class="line">		<span class="keyword">if</span> (hasFoundPlayer()) &#123;			<span class="comment">//当电脑角色方向玩家角色后的追赶动作</span></span><br><span class="line">			<span class="keyword">if</span>(Math.abs(locY - gameWorld.getOffsetY()- gameWorld.gameP.man.getY() ) &lt; GamePanel.HEIGHT/<span class="number">3</span>)</span><br><span class="line">				<span class="keyword">if</span> (locX - gameWorld.getOffsetX() &gt; gameWorld.gameP.man.getX()) &#123;</span><br><span class="line">					dx = -Math.abs(dx);	<span class="comment">//若在玩家角色的右边则向左追逐</span></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					dx = Math.abs(dx);	<span class="comment">//若在玩家角色的左边则向右追逐</span></span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasFoundPlayer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (locX - gameWorld.getOffsetX() &gt; <span class="number">0</span>)</span><br><span class="line">				&amp;&amp; (locX - gameWorld.getOffsetX() &lt; GamePanel.WIDTH</span><br><span class="line">						&amp;&amp; locY - gameWorld.getOffsetY() &gt; <span class="number">0</span> &amp;&amp; locY</span><br><span class="line">						- gameWorld.getOffsetY() &lt; GamePanel.HEIGHT);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-9-NPC的碰撞检测"><a href="#2-3-9-NPC的碰撞检测" class="headerlink" title="2.3.9 NPC的碰撞检测"></a>2.3.9 NPC的碰撞检测</h3><p>实现NPC间的碰撞检测及处理，两个NPC碰到后相互按相反的方向移动。调用getSprites方法，判断两个NPC是否碰撞，若碰撞则更改两个NPC的dx值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; gameWorld.getSprites().size()-<span class="number">1</span>; i++) &#123;	<span class="comment">//NPC的碰撞检测</span></span><br><span class="line">		EnemyProp eny1 = (EnemyProp) gameWorld.getSprites().get(i);</span><br><span class="line">		EnemyProp eny2 = (EnemyProp) gameWorld.getSprites().get(i+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> ((gameWorld.spriteCollision(eny1, eny2, <span class="keyword">false</span>))&amp;&amp;(eny1.npcType == EnemyProp.ANPC)&amp;&amp;(eny2.npcType == EnemyProp.ANPC))&#123;</span><br><span class="line">			eny1.dx = -eny1.dx;</span><br><span class="line">			eny2.dx = -eny2.dx;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-玩家角色生命值与道具"><a href="#2-4-玩家角色生命值与道具" class="headerlink" title="2.4 玩家角色生命值与道具"></a>2.4 玩家角色生命值与道具</h2><h3 id="2-4-1玩家角色生命减少"><a href="#2-4-1玩家角色生命减少" class="headerlink" title="2.4.1玩家角色生命减少"></a>2.4.1玩家角色生命减少</h3><p>在玩家角色遭遇到攻击之后其生命值要减少一个单位，同时游戏会继续运行。为了避免玩家持续地遭到攻击，需要为玩家角色设定一个“无敌”时间，即从玩家角色被攻击时算起的一小段时间内玩家角色将不会再遭遇到攻击。</p>
<div align=center>

<p><img src="clip_image002-1585408228511.jpg" alt="玩家角色的有限状态机模型"></p>
</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span> </span>&#123;				<span class="comment">//绘制精灵图像，并实现无敌状态的闪烁效果</span></span><br><span class="line">		drawHearts(g);</span><br><span class="line">		<span class="keyword">if</span> (state == UNATTACK &amp;&amp; (count % <span class="number">5</span> == <span class="number">0</span>)) &#123;	<span class="comment">//当玩家角色处于无敌态时，每隔5帧便停止绘制一次</span></span><br><span class="line">			<span class="comment">//跳过绘制的步骤</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">switch</span> (runningState) &#123;				<span class="comment">//选择玩家运动状态</span></span><br><span class="line">			<span class="keyword">case</span> RUNRT:</span><br><span class="line">				animRight.draw(g, locX, locY);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> RUNLT:</span><br><span class="line">				animLeft.draw(g, locX, locY);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> STDRT:</span><br><span class="line">				animRight.draw(g, locX, locY);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> STDLT:</span><br><span class="line">				animLeft.draw(g, locX, locY);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;						<span class="comment">//更新角色的坐标</span></span><br><span class="line">		<span class="keyword">switch</span> (state) &#123;						<span class="comment">//判定玩家角色的状态值</span></span><br><span class="line">		<span class="keyword">case</span> ISHITTED:							<span class="comment">//若为被攻状态</span></span><br><span class="line">			lives--;							<span class="comment">//生命值减1</span></span><br><span class="line">			updateHearts();</span><br><span class="line">			<span class="keyword">if</span> (lives &lt;= <span class="number">0</span>) &#123;					<span class="comment">//对lives值进行判定以便进行相应的状态转换</span></span><br><span class="line">				changeState(DISMISS);			<span class="comment">//转为死亡态</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				changeState(UNATTACK);			<span class="comment">//转为无敌态</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> UNATTACK:							<span class="comment">//若为无敌态</span></span><br><span class="line">			<span class="comment">//通过count累加该段时间内游戏运行的总帧数，即游戏循环进行的总次数</span></span><br><span class="line">			count = (count + <span class="number">1</span>) % (GamePanel.FPS * <span class="number">5</span>);</span><br><span class="line">			<span class="comment">//当count的值等于5秒内游戏循环的总次数时改变电脑角色的状态值</span></span><br><span class="line">			<span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">				changeState(MOVE);				<span class="comment">//转为活动态</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> MOVE:								<span class="comment">//若为活动态</span></span><br><span class="line">			move();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> DISMISS:							<span class="comment">//若为死亡态</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2道具"><a href="#2-4-2道具" class="headerlink" title="2.4.2道具"></a>2.4.2道具</h3><p>在游戏中提供三种游戏道具：“守护”道具为玩家角色提供5秒的无敌效果；“红心”道具为玩家提供一个额外的生命值（在生命值没有到达上限的情况下）；“跳跳靴”道具为玩家提供更高的起跳速度从而跳得更高。</p>
<table>
<thead>
<tr>
<th align="center"><img src="clip_image002-1585408275816.png" alt="img"></th>
<th align="center"><img src="clip_image004.png" alt="img"></th>
<th align="center"><img src="clip_image006.png" alt="img"></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>守护</strong></td>
<td align="center"><strong>红心</strong></td>
<td align="center"><strong>跳跳靴</strong></td>
</tr>
</tbody></table>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (eny.npcType == EnemyProp.SNPC) &#123;			<span class="comment">//若玩家获取了道具</span></span><br><span class="line">					sound.loadSound(<span class="string">"Sounds/eat.wav"</span>);	<span class="comment">//加载音效文件</span></span><br><span class="line">					sound.playSound();								<span class="comment">//播放玩家获取道具的音效</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (eny.npcName.equals(<span class="string">"star"</span>)) &#123;				<span class="comment">//若道具为“守护”</span></span><br><span class="line">			eny.changeState(Sprite.DISMISS);			<span class="comment">//撤销道具</span></span><br><span class="line">			man.resetCount();							<span class="comment">//将玩家设为无敌状态</span></span><br><span class="line">			man.changeState(Player.UNATTACK);			<span class="comment">//重置无敌时间</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (eny.npcName.equals(<span class="string">"heart"</span>)) &#123;				<span class="comment">//若道具为“红心”</span></span><br><span class="line">			eny.changeState(Sprite.DISMISS);			<span class="comment">//撤销道具</span></span><br><span class="line">			<span class="keyword">if</span> (man.lives &lt; Player.LFNUM) &#123;				<span class="comment">//若玩家生命未达到上限</span></span><br><span class="line">				man.lives++;							<span class="comment">//生命值加1</span></span><br><span class="line">			&#125;</span><br><span class="line">		man.updateHearts();							<span class="comment">//更新玩家生命值图像显示</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (eny.npcName.equals(<span class="string">"power"</span>)) &#123;				<span class="comment">//若道具为“跳跳靴"</span></span><br><span class="line">			eny.changeState(Sprite.DISMISS);			<span class="comment">//撤销道具</span></span><br><span class="line">			man.jumpSpeed -= <span class="number">10</span>;						<span class="comment">//增加玩家的起跳速度</span></span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-5-游戏UI"><a href="#2-5-游戏UI" class="headerlink" title="2.5 游戏UI"></a>2.5 游戏UI</h2><h3 id="2-5-1显示玩家生命"><a href="#2-5-1显示玩家生命" class="headerlink" title="2.5.1显示玩家生命"></a>2.5.1显示玩家生命</h3><p>在玩家角色遭遇到攻击之后其生命值要减少一个单位，同时游戏会继续运行。为了避免玩家持续地遭到攻击，需要为玩家角色设定一个“无敌”时间，即从玩家角色被攻击时算起的一小段时间内玩家角色将不会再遭遇到攻击。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//绘制各个生命对象的图像</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawHearts</span><span class="params">(Graphics g)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hearts.size(); i++) &#123;</span><br><span class="line">		heart = (Life) hearts.get(i);			<span class="comment">//从数组列表中取出一个生命对象</span></span><br><span class="line">		heart.draw(g);							<span class="comment">//绘制该对象的图像</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//更新各个生命对象的坐标值</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateHearts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	hearts.clear();								<span class="comment">//清空数组列表对象</span></span><br><span class="line">	<span class="comment">//根据玩家角色的生命值，循环地建立各个生命对象</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lives; i++) &#123;</span><br><span class="line">		heart = <span class="keyword">new</span> Life();						<span class="comment">//生成新的生命对象</span></span><br><span class="line">		heart.setX(i * heart.getWidth());		<span class="comment">//设置横坐标</span></span><br><span class="line">		hearts.add(heart);						<span class="comment">//加入数组列表</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-2显示游戏分数值和剩余敌人"><a href="#2-5-2显示游戏分数值和剩余敌人" class="headerlink" title="2.5.2显示游戏分数值和剩余敌人"></a>2.5.2显示游戏分数值和剩余敌人</h3><p>在游戏中设定得分数，用来对玩家角色消灭敌人的行为表示奖励，并显示剩余敌人数量。游戏运行过程中需要不断地统计游戏分数值，并将其显示在游戏屏幕上。规定玩家角色跳起踩到电脑角色后加100分，而当其发生子弹击中电脑角色后只加50分。</p>
<p>若玩家生命值为0或是掉入悬崖，则游戏结束，显示“Game Over！”，若玩家成功通关，则显示“Finished”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Font font = <span class="keyword">new</span> Font(<span class="string">"Tahoma"</span>, Font.PLAIN, <span class="number">20</span>);	<span class="comment">//创建字体对象</span></span><br><span class="line">		dbg.setFont(font);												<span class="comment">//设置字体</span></span><br><span class="line">		<span class="keyword">if</span> (level &gt;= <span class="number">1</span> &amp;&amp; level &lt;= TOTALLEVEL) &#123;</span><br><span class="line">			dbg.drawString(<span class="string">"Score:"</span> + score, <span class="number">5</span>, <span class="number">60</span>);		<span class="comment">//显示分数值</span></span><br><span class="line">			dbg.drawString(<span class="string">"Enemy:"</span> + gameWorld.anpcNum, <span class="number">5</span>, <span class="number">85</span>);	<span class="comment">//显示剩余敌人</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (state == GameOver) &#123;</span><br><span class="line">			font = <span class="keyword">new</span> Font(<span class="string">"Tahoma"</span>, Font.PLAIN, <span class="number">90</span>);</span><br><span class="line">			dbg.setFont(font);</span><br><span class="line">			dbg.drawString(<span class="string">"Game Over!"</span>, <span class="number">0</span>, HEIGHT / <span class="number">2</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == GameFinish) &#123;</span><br><span class="line">			font = <span class="keyword">new</span> Font(<span class="string">"Tahoma"</span>, Font.PLAIN, <span class="number">90</span>);</span><br><span class="line">			dbg.setFont(font);</span><br><span class="line">			dbg.drawString(<span class="string">"  Finished!"</span>, <span class="number">0</span>, HEIGHT / <span class="number">2</span>);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-游戏的类"><a href="#3-游戏的类" class="headerlink" title="3. 游戏的类"></a>3. 游戏的类</h1><p><strong>3.1 Animation</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> BufferedImage[] Images;        <span class="comment">//精灵图像</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> numImages;                <span class="comment">//精灵图像的张数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> ticksStopped;           <span class="comment">//标记精灵图像更新</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isRepeating;            <span class="comment">//标记精灵动画播放循环</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> animTime;                 <span class="comment">//精灵动画播放时间</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> animSpeed;                <span class="comment">//精灵动画播放速度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> animTotalTime;             <span class="comment">//精灵动画总播放时间</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> showTime;                 <span class="comment">//单幅精灵动画持续时间</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> imPosition;                 <span class="comment">//当前精灵图像</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Animation</span><span class="params">(String fileName,<span class="keyword">int</span> num,<span class="keyword">int</span> speed,<span class="keyword">int</span> totalTime,<span class="keyword">boolean</span> repeat)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Animation</span><span class="params">(String prefixfileName,String postfixFileName ,<span class="keyword">int</span> num,<span class="keyword">int</span> speed,<span class="keyword">int</span> totalTime,<span class="keyword">boolean</span> repeat)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage <span class="title">loadImage</span><span class="params">(String fnm)</span>:<span class="title">return</span><span class="params">(im)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage[] <span class="title">setAnimImagesFromOneFile</span><span class="params">(String fnm, <span class="keyword">int</span> num)</span>:<span class="title">return</span><span class="params">(ims)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage[] <span class="title">setAnimImagesFromFiles</span><span class="params">(String prefixFileName,String postFileName, <span class="keyword">int</span> num)</span> <span class="title">return</span><span class="params">(ims)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateImage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage <span class="title">getCurrentImage</span><span class="params">()</span>:return Images[imPosition]</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isStopped</span><span class="params">()</span>:return ticksStopped</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resume</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g,<span class="keyword">int</span> x ,<span class="keyword">int</span> y)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.2 Bullet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Player player;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Bullet</span><span class="params">(Player man)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.3 EnemyProp</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> GRAVITY = <span class="number">1</span>;           <span class="comment">//重力加速度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> JUMPSPEED = <span class="number">20</span>;       <span class="comment">//跳跃速度</span></span><br><span class="line"><span class="keyword">private</span> Animation animRight, animLeft;         <span class="comment">//电脑角色向右/左运动的精灵动画对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> numImages;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> runningRight, runningLeft, standRight, standLeft;    <span class="comment">//标识电脑角色是否向右/左运动/站立</span></span><br><span class="line"><span class="keyword">private</span> GameWorldManager gameWorld;		<span class="comment">//GameWorldManager对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> offsetX, offsetY;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> jumpSpeed;						<span class="comment">//跳跃速度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> isJumping = <span class="keyword">false</span>;				<span class="comment">//标记跳起状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canJump = <span class="keyword">false</span>;				<span class="comment">//标记跳跃状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> onGround = <span class="keyword">false</span>;				<span class="comment">//标记是否位于地面</span></span><br><span class="line"><span class="keyword">private</span> SoundPlayer sound;					<span class="comment">//SoundPlayer对象</span></span><br><span class="line"><span class="keyword">public</span> String npcName;						<span class="comment">//定义NPC名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> npcType;							<span class="comment">//定义NPC类型（敌人或道具）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ANPC = <span class="number">0</span>;				<span class="comment">//该字符常量表示敌人</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SNPC = <span class="number">1</span>;				<span class="comment">//该字符常量表示道具</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EnemyProp</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> type, String name, <span class="keyword">int</span> numImage, GameWorldManager gameW)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EnemyProp</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> type, String name, GameWorldManager gameW)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jump</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jumpStopped</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasFoundPlayer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Point <span class="title">thisPosition</span><span class="params">()</span>:return new <span class="title">Point</span><span class="params">(thisX, thisY)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Point <span class="title">nextPosition</span><span class="params">()</span>:return new <span class="title">Point</span><span class="params">(nextX, nextY)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setJumpSpeed</span><span class="params">(<span class="keyword">int</span> jumpS)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.4 GameFrame</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GameFrame</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.5 GamePanel</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FPS = <span class="number">50</span>;						<span class="comment">//游戏运行帧率</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> WIDTH = <span class="number">500</span>;					<span class="comment">//游戏窗口宽度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> HEIGHT = <span class="number">360</span>;					<span class="comment">//游戏窗口高度</span></span><br><span class="line"><span class="keyword">private</span> Image im;</span><br><span class="line"><span class="keyword">private</span> Graphics dbg;</span><br><span class="line"><span class="keyword">private</span> Thread gamethread;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> running = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isPaused = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GameRunning = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GameOver = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GamePaused = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GameFinish = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">public</span> Player man;</span><br><span class="line"><span class="keyword">private</span> ArrayList enemy;</span><br><span class="line"><span class="keyword">private</span> GameWorldManager gameWorld;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> score;									<span class="comment">//score变量用来表示游戏分数值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> isGameOver = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> SoundPlayer sound;</span><br><span class="line"><span class="keyword">public</span> MusicPlayer music;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> isMusicStopped = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> Bullet bul;									<span class="comment">//子弹对象</span></span><br><span class="line"><span class="keyword">public</span> ArrayList bullets;								<span class="comment">//数组列表用来保存所有子弹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> leftPressed = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> rightPressed = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> level = <span class="number">1</span>;							<span class="comment">//记录当前关卡的编号</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> levelUp = <span class="keyword">false</span>;						<span class="comment">//表示当前关卡是否通过</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOTALLEVEL = <span class="number">1</span>;				<span class="comment">//游戏的总关卡数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GamePanel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gameStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeState</span><span class="params">(<span class="keyword">int</span> s)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gameStop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkCollision</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gamePaint</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkGameOver</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadLevel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkShooting</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gameRender</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">gameUpdate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyTyped</span><span class="params">(KeyEvent e)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyReleased</span><span class="params">(KeyEvent e)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.6 GameWorldManager</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> imMoveSize;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> TILE_SIZE = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">private</span> BufferedImage im1,  im2,  im3;           <span class="comment">//分别保存3幅卷轴型图像</span></span><br><span class="line"><span class="keyword">private</span> Ribbon bg1,  bg2,  bg3;                 <span class="comment">//3个卷轴型图像对象</span></span><br><span class="line"><span class="keyword">private</span> ArrayList tiles;</span><br><span class="line"><span class="keyword">public</span> TileMap tMap;                            <span class="comment">//砖块型图像对象</span></span><br><span class="line"><span class="keyword">private</span> BufferedImage[] tileImage;                 <span class="comment">//保存所有砖块型图像</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canMoveRight;                    <span class="comment">//标识图像向右滚动</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canMoveLeft;                     <span class="comment">//标识图像向左滚动</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canScroll = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">private</span> ArrayList sprites;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> anpcNum;</span><br><span class="line"><span class="keyword">public</span> Player player;</span><br><span class="line"><span class="keyword">public</span> GamePanel gameP;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GameWorldManager</span><span class="params">(GamePanel gp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoveFlag</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TileMap <span class="title">loadTileMap</span><span class="params">(String filename)</span>: return newMap</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage <span class="title">loadImage</span><span class="params">(String fnm)</span>: return im</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Point <span class="title">checkTileCollision</span><span class="params">(Sprite sprite,<span class="keyword">int</span> oldX, <span class="keyword">int</span> oldY, <span class="keyword">int</span> newX, <span class="keyword">int</span> newY)</span>: return pointCache</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">worldCollisionHorizontal</span><span class="params">(Sprite sprite, Point thisPos, Point nextPos, <span class="keyword">int</span> offSetX)</span>: return <span class="keyword">true</span>/<span class="keyword">false</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">worldCollisionVertical</span><span class="params">(Sprite sprite, Point thisPos, Point nextPos, <span class="keyword">int</span> offSetY)</span>: return <span class="keyword">true</span>/<span class="keyword">false</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">spriteCollision</span><span class="params">(Sprite s1, Sprite s2, <span class="keyword">boolean</span> isPlayer)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOffsetY</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOffsetY</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOffsetX</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ArrayList <span class="title">getSprites</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isScrollLeft</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isScrollRight</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.7 Life</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Life</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.8 MusicPlayer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Sequence sequence;</span><br><span class="line"><span class="keyword">private</span> Sequencer sequencer;</span><br><span class="line"><span class="keyword">private</span> File file;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MusicPlayer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadMusic</span><span class="params">(String fileName)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMusic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopPlaying</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isStopped</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.9 Player</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> GRAVITY = <span class="number">1</span>;				<span class="comment">//重力加速度值为1</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> INISPEED = <span class="number">20</span>;				<span class="comment">//跳跃初速度为20</span></span><br><span class="line"><span class="keyword">private</span> Animation animRight, animLeft;			<span class="comment">//向右/左行走的动画对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> runningRight, runningLeft, standRight, standLeft;	<span class="comment">//标识是否向右/左运动，是否朝右/左站立不动</span></span><br><span class="line"><span class="keyword">private</span> GameWorldManager gameWorld;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> offsetX, offsetY;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> jumpSpeed;							<span class="comment">//跳跃速度值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> isJumping = <span class="keyword">false</span>;					<span class="comment">//标识是否处于跳起阶段</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canJump = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> onGround = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNATTACK = <span class="number">3</span>;				<span class="comment">//无敌态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UpScrollY = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DownScrollY = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> runningState = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNRT = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNLT = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STDRT = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STDLT = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LFNUM = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> lives = LFNUM;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> ArrayList hearts;							<span class="comment">//创建数组列表对象</span></span><br><span class="line"><span class="keyword">private</span> Life heart;								<span class="comment">//创建生命对象</span></span><br><span class="line"><span class="keyword">private</span> GamePanel gameP;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> scrollCount = GamePanel.HEIGHT;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">(GameWorldManager world, GamePanel gp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawHearts</span><span class="params">(Graphics g)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateHearts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resetCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Point <span class="title">thisPosition</span><span class="params">()</span>:return new <span class="title">Point</span><span class="params">(thisX, thisY)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Point <span class="title">nextPosition</span><span class="params">()</span>:return new <span class="title">Point</span><span class="params">(thisX, thisY)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setJumpSpeed</span><span class="params">(<span class="keyword">int</span> jumpS)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.10 Ribbon</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BufferedImage bim;	<span class="comment">//图像对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> xImHead;		<span class="comment">//图像头指针</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pWidth;			<span class="comment">//窗口宽度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pHeight;		    <span class="comment">//窗口高度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> width;			<span class="comment">//图像宽度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> moveSize;		<span class="comment">//移动速度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canMoveRight;<span class="comment">//向右移动标志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> canMoveLeft; <span class="comment">//向左移动标志</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Ribbon</span><span class="params">(<span class="keyword">int</span> movS, BufferedImage im)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawRibbon</span><span class="params">(Graphics g, BufferedImage im, <span class="keyword">int</span> dx1, <span class="keyword">int</span> dx2, <span class="keyword">int</span> sx1, <span class="keyword">int</span> sx2)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.11 SoundPlayer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File file;</span><br><span class="line">AudioInputStream stream;</span><br><span class="line">AudioFormat format;</span><br><span class="line">DataLine.Info info;</span><br><span class="line">Clip clip;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadSound</span><span class="params">(String fileName)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playSound</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<p><strong>3.12 Sprite</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> locX;                         <span class="comment">//精灵的横坐标</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> locY;                         <span class="comment">//精灵的纵坐标</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> dx;                           <span class="comment">//精灵的水平运动速度</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> dy;                           <span class="comment">//精灵的垂直运动速度</span></span><br><span class="line"><span class="keyword">protected</span> Animation animPlayer;             <span class="comment">//动画对象</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> numImages;                    <span class="comment">//精灵图像的张数</span></span><br><span class="line"><span class="keyword">protected</span> String imFileName;                <span class="comment">//精灵图像文件名</span></span><br><span class="line"><span class="keyword">protected</span> BufferedImage image;              <span class="comment">//精灵图像对象</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> width,  height;               <span class="comment">//精灵图像的宽度/高度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">boolean</span> isLooping;                <span class="comment">//标识精灵动画是否播放</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pWidth,  pHeight;               <span class="comment">//游戏Panel范围</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isActive = <span class="keyword">true</span>;            <span class="comment">//标记精灵的活动状态</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">int</span> state;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MOVE = <span class="number">0</span>;        <span class="comment">//移动态</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DISMISS = <span class="number">1</span>;     <span class="comment">//消失态</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ISHITTED = <span class="number">2</span>;    <span class="comment">//掉落态</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Sprite</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, String imfile, <span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage <span class="title">setImage</span><span class="params">(String fnm)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loopImage</span><span class="params">(<span class="keyword">int</span> animPeriod, <span class="keyword">int</span> seqDuration</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">public</span> <span class="keyword">void</span> stopLooping()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isActive</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActive</span><span class="params">(<span class="keyword">boolean</span> a)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDX</span><span class="params">(<span class="keyword">int</span> x)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDY</span><span class="params">(<span class="keyword">int</span> y)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDX</span><span class="params">()</span> :return dx</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDY</span><span class="params">()</span> :return dy</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setX</span><span class="params">(<span class="keyword">int</span> x)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setY</span><span class="params">(<span class="keyword">int</span> y)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> :return locX</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> :return locY</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> :return height</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> :return width</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeState</span><span class="params">(<span class="keyword">int</span> s)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> :return state</span></span><br></pre></td></tr></table></figure>

<p><strong>3.13 TileMap</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> BufferedImage[][] tiles;              <span class="comment">//存放各个砖块型图像</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> xMapHead;                     <span class="comment">//TileMap头指针</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> TILE_SIZE = <span class="number">64</span>;                 <span class="comment">//砖块型图像尺寸为64x64</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> offsetX;                        <span class="comment">//水平方向偏移值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> offsetY;                         <span class="comment">//垂直方向偏移值</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pWidth;                        <span class="comment">//程序窗口宽度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> pHeight;                        <span class="comment">//程序窗口高度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mapWidth;                      <span class="comment">//TileMap的宽度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mapMoveSize;                   <span class="comment">//TileMap的滚动速度</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> tMapMoveRight = <span class="keyword">false</span>;       <span class="comment">//标识TileMap向右滚动</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> tMapMoveLeft = <span class="keyword">false</span>;        <span class="comment">//标识TileMap向左滚动</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TileMap</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMapHead</span><span class="params">()</span>:return xMapHead</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> :return tiles.length1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> :return tiles[0].length</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BufferedImage <span class="title">getTile</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span>: return tiles[x][y]</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTile</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, BufferedImage tile)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">tilesToPixels</span><span class="params">(<span class="keyword">int</span> numTiles)</span>: return pixelSize</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pixelsToTiles</span><span class="params">(<span class="keyword">int</span> pixelCoord)</span>: return numTiles</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Graphics g)</span></span></span><br></pre></td></tr></table></figure>

<h1 id="4-游戏测试"><a href="#4-游戏测试" class="headerlink" title="4. 游戏测试"></a>4. 游戏测试</h1><div align=center>

<p><img src="image-20200331163815947.png" alt="游戏"></p>
<p><img src="image-20200331163904036.png" alt="失败"></p>
</div>
        </div>
            
                    <ul class="post-copyright">
                    <li><strong>本文标题：</strong><a href="http://www.zanple.top/2019/12/24/java-2d-act/">Java横板小游戏</a></li>
                    <li><strong>本文作者：</strong><a href="http://www.zanple.top">Zanple</a></li>
                    <li><strong>本文链接：</strong><a href="http://www.zanple.top/2019/12/24/java-2d-act/">http://www.zanple.top/2019/12/24/java-2d-act/</a></li>
                    <li><strong>发布时间：</strong>2019-12-24</li>
                    <li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
                    </li>
                    </ul>
                
        
            <hr style="height:1px;margin:1rem 0"/>
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                        <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/Java/" rel="tag">Java</a>,&nbsp;<a class="has-link-grey -link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/images/wechat.jpg" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2020/01/02/beacon-web/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">灯塔网</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/11/26/digtalmedia-web/">
                <span class="level-item">数媒自习室-基于ASP的动态网页开发</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="valine-thread" class="content"></div>
<script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: false,
        verify: false,
        app_id: 'vnCU1DBATElvGAC8uHCfuJCS-gzGzoHsz',
        app_key: 'neteGEzdBfz0C9UPU5tHdP7H',
        placeholder: '欢迎留下评论呀~'
    });
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/photo.png" alt="Zanple">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Zanple
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Student
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Guangzhou,Guangdong</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            43
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            20
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            44
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://zhihu.com/people/zanple/" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Zhihu" href="https://zhihu.com/people/zanple/">
                
                <i class="fab fa-zhihu"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="ArtStation" href="https://www.artstation.com/zanple/">
                
                <i class="fab fa-artstation"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Bilibili" href="https://space.bilibili.com/293017566">
                
                <i class="fab fa-bimobject"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/ZanpleLee/">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        

    <div class="card widget column-left is-sticky" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    目录
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#1-游戏设计">
        <!-- span class="has-mr-6">1</span-->
        <span>1. 游戏设计</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-1-游戏规则">
        <!-- span class="has-mr-6">1.1</span-->
        <span>1.1 游戏规则</span>
        </a></li><li>
        <a class="is-flex" href="#1-2-游戏程序流程图">
        <!-- span class="has-mr-6">1.2</span-->
        <span>1.2 游戏程序流程图</span>
        </a></li><li>
        <a class="is-flex" href="#1-3-类设计">
        <!-- span class="has-mr-6">1.3</span-->
        <span>1.3 类设计</span>
        </a></li><li>
        <a class="is-flex" href="#1-4-模块设计">
        <!-- span class="has-mr-6">1.4</span-->
        <span>1.4 模块设计</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-4-1-游戏精灵模块">
        <!-- span class="has-mr-6">1.4.1</span-->
        <span>1.4.1 游戏精灵模块</span>
        </a></li><li>
        <a class="is-flex" href="#1-4-2-地图模块">
        <!-- span class="has-mr-6">1.4.2</span-->
        <span>1.4.2 地图模块</span>
        </a></li><li>
        <a class="is-flex" href="#1-4-3-音乐音效模块">
        <!-- span class="has-mr-6">1.4.3</span-->
        <span>1.4.3 音乐音效模块</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#2-详细设计">
        <!-- span class="has-mr-6">2</span-->
        <span>2. 详细设计</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-1-卷轴图像">
        <!-- span class="has-mr-6">2.1</span-->
        <span>2.1 卷轴图像</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-1-1卷轴的滚动显示">
        <!-- span class="has-mr-6">2.1.1</span-->
        <span>2.1.1卷轴的滚动显示</span>
        </a></li><li>
        <a class="is-flex" href="#2-1-2卷轴的单向滚动">
        <!-- span class="has-mr-6">2.1.2</span-->
        <span>2.1.2卷轴的单向滚动</span>
        </a></li><li>
        <a class="is-flex" href="#2-1-3载入地图">
        <!-- span class="has-mr-6">2.1.3</span-->
        <span>2.1.3载入地图</span>
        </a></li><li>
        <a class="is-flex" href="#2-1-4垂直滚动场景">
        <!-- span class="has-mr-6">2.1.4</span-->
        <span>2.1.4垂直滚动场景</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#2-2-精灵">
        <!-- span class="has-mr-6">2.2</span-->
        <span>2.2 精灵</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-2-1精灵图像的绘制">
        <!-- span class="has-mr-6">2.2.1</span-->
        <span>2.2.1精灵图像的绘制</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#2-3-角色与场景的交互">
        <!-- span class="has-mr-6">2.3</span-->
        <span>2.3 角色与场景的交互</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-3-1精灵图像的绘制">
        <!-- span class="has-mr-6">2.3.1</span-->
        <span>2.3.1精灵图像的绘制</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-2碰撞检测方法">
        <!-- span class="has-mr-6">2.3.2</span-->
        <span>2.3.2碰撞检测方法</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-3水平方向的碰撞检测">
        <!-- span class="has-mr-6">2.3.3</span-->
        <span>2.3.3水平方向的碰撞检测</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-4垂直方向的碰撞检测">
        <!-- span class="has-mr-6">2.3.4</span-->
        <span>2.3.4垂直方向的碰撞检测</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-5精灵角色碰撞检测的方法">
        <!-- span class="has-mr-6">2.3.5</span-->
        <span>2.3.5精灵角色碰撞检测的方法</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-6玩家角色跳起来“踩”电脑角色">
        <!-- span class="has-mr-6">2.3.6</span-->
        <span>2.3.6玩家角色跳起来“踩”电脑角色</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-7玩家角色发射子弹攻击电脑角色">
        <!-- span class="has-mr-6">2.3.7</span-->
        <span>2.3.7玩家角色发射子弹攻击电脑角色</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-8电脑角色追逐玩家角色">
        <!-- span class="has-mr-6">2.3.8</span-->
        <span>2.3.8电脑角色追逐玩家角色</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-9-NPC的碰撞检测">
        <!-- span class="has-mr-6">2.3.9</span-->
        <span>2.3.9 NPC的碰撞检测</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#2-4-玩家角色生命值与道具">
        <!-- span class="has-mr-6">2.4</span-->
        <span>2.4 玩家角色生命值与道具</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-4-1玩家角色生命减少">
        <!-- span class="has-mr-6">2.4.1</span-->
        <span>2.4.1玩家角色生命减少</span>
        </a></li><li>
        <a class="is-flex" href="#2-4-2道具">
        <!-- span class="has-mr-6">2.4.2</span-->
        <span>2.4.2道具</span>
        </a></li><li>
        <a class="is-flex" href="#">
        <!-- span class="has-mr-6">2.4.3</span-->
        <span></span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#2-5-游戏UI">
        <!-- span class="has-mr-6">2.5</span-->
        <span>2.5 游戏UI</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-5-1显示玩家生命">
        <!-- span class="has-mr-6">2.5.1</span-->
        <span>2.5.1显示玩家生命</span>
        </a></li><li>
        <a class="is-flex" href="#2-5-2显示游戏分数值和剩余敌人">
        <!-- span class="has-mr-6">2.5.2</span-->
        <span>2.5.2显示游戏分数值和剩余敌人</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#3-游戏的类">
        <!-- span class="has-mr-6">3</span-->
        <span>3. 游戏的类</span>
        </a></li><li>
        <a class="is-flex" href="#4-游戏测试">
        <!-- span class="has-mr-6">4</span-->
        <span>4. 游戏测试</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Java横板小游戏" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Zanple&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                <br> 
                <a class="has-link-black-ter-2 -link" href="http://beian.miit.gov.cn/" target="_blank">粤ICP备20031956号</a>
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://www.zanple.top',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>