<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Unity小游戏-新冠入侵 - Addendum</title>


    <meta name="description" content="利用Unity独立开发的一个塔防类的小游戏~">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity小游戏-新冠入侵">
<meta property="og:url" content="http://www.zanple.top/2020/05/13/unity-coviddefend/index.html">
<meta property="og:site_name" content="Addendum">
<meta property="og:description" content="利用Unity独立开发的一个塔防类的小游戏~">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.zanple.top/gallery/unity-coviddefend.png">
<meta property="article:published_time" content="2020-05-13T04:49:10.000Z">
<meta property="article:modified_time" content="2020-09-05T08:17:37.385Z">
<meta property="article:author" content="Zanple">
<meta property="article:tag" content="游戏">
<meta property="article:tag" content="works">
<meta property="article:tag" content="Unity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.zanple.top/gallery/unity-coviddefend.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="Addendum" type="application/atom+xml">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Unity小游戏-新冠入侵" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ZanpleLee/">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/gallery/unity-coviddefend.png" alt="Unity小游戏-新冠入侵">
        </span>
    </div>
    
    <div class="card-content article ">
            <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
                    
                        <i class="fas fa-angle-double-right"></i>Unity小游戏-新冠入侵
                    
                </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                    <time class="level-item has-text-grey" datetime="2020-05-13T04:49:10.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2020-05-13</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2020-09-05T08:17:37.385Z"><i class="far fa-calendar-check">&nbsp;</i>2020-09-05</time>
                
                
                <div class="level-item">
                        <i class="far fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/Unity/">Unity</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                        <i class="far fa-clock"></i>&nbsp;
                    
                    
                    40 分钟 读完 (大约 5997 个字)
                </span>
                
                
            </div>
        </div>
        
        <div class="content">
            <blockquote>
<p>利用Unity独立开发的一个塔防类的小游戏~<a id="more"></a></p>
</blockquote>
<div class="bilibili">

<iframe src="//player.bilibili.com/player.html?aid=583174672&bvid=BV1Mz4y1d7s3&cid=191730581&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

</div>

<hr>
<h1 id="1-游戏简介"><a href="#1-游戏简介" class="headerlink" title="1. 游戏简介"></a>1. 游戏简介</h1><p>《新冠入侵》是一个基于安卓平台开发的抗击新冠疫情的小游戏，使用了<code>Unity2019.3.3f1</code>进行游戏的开发、<code>Adobe Photoshop CC 2019</code>完成美术资源的设计。</p>
<p>游戏技术点包含常用设计模式辅助项目开发（<strong>单例，工厂，对象池，中介者，外观，状态，责任链</strong>等模式），DoTween插件的使用方法，使用JsonMapper去解析和存贮简单json与复杂json，json的使用注意事项与强制解析。编辑器拓展功能来制作地图工具（提高我们游戏开发效率，自己制作一个简单插件）。还有更多细碎知识诸如数值策划知识，游戏物体在Inspector的调整，2D开发中常遇到问题的展现与解决，面向接口编程的使用与体验，对象池技术，Unity的2D图集处理，并切割出一张张小图片。Unity中赋值顺序探索等等。</p>
<h1 id="2-游戏需求与流程"><a href="#2-游戏需求与流程" class="headerlink" title="2. 游戏需求与流程"></a>2. 游戏需求与流程</h1><div align=center>
<img src="需求.svg" alt="游戏需求与流程" width="80%" />
</div>

<h1 id="3-美术资源设计"><a href="#3-美术资源设计" class="headerlink" title="3. 美术资源设计"></a>3. 美术资源设计</h1><h2 id="3-1-按钮设计"><a href="#3-1-按钮设计" class="headerlink" title="3.1 按钮设计"></a>3.1 按钮设计</h2><p>按钮与游戏标题保持风格一致性，大部分为手绘风格，并使用鲜明的颜色。由于本游戏是针对安卓平台开发的，因此按钮只需要常规与Press状态，Press状态大多使用阴影表现。</p>
<div align=center>

<p><img src="image-20200519173341258.png" alt="按钮设计图"></p>
</div>

<h2 id="3-2-页面设计"><a href="#3-2-页面设计" class="headerlink" title="3.2 页面设计"></a>3.2 页面设计</h2><p>按页面整体均为卡通手绘风格，使游戏能够有较大的用户群体。</p>
<div align=center>

<p><img src="image-20200519174344081.png" alt="游戏主页面"></p>
<p><img src="image-20200519174353151.png" alt="设置页面"></p>
<p><img src="image-20200519174403714.png" alt="帮助页面1"></p>
<p><img src="image-20200519174411958.png" alt="帮助页面2"></p>
<p><img src="image-20200519174420298.png" alt="帮助页面3"></p>
<p><img src="image-20200519174428698.png" alt="关卡选择页面"></p>
<p><img src="image-20200519173952073.png" alt="游戏界面"></p>
<p><img src="image-20200519174007004.png" alt="菜单页面"></p>
<p><img src="image-20200519174014180.png" alt="失败页面"></p>
<p><img src="image-20200519174020112.png" alt="胜利页面"></p>
</div>

<h1 id="4-游戏设计模式与玩法机制"><a href="#4-游戏设计模式与玩法机制" class="headerlink" title="4. 游戏设计模式与玩法机制"></a>4. 游戏设计模式与玩法机制</h1><h2 id="4-1-设计模式"><a href="#4-1-设计模式" class="headerlink" title="4.1 设计模式"></a>4.1 设计模式</h2><p>本游戏综合使用了多种游戏设计模式。包括单例模式、工厂模式、对象池模式、外观模式、中介者模式、建造者模式、责任链模式。</p>
<ol>
<li><strong>单例模式：</strong>单例模式是一种常见的设计模式，具有以下特点：单例类只能有一个实例、单例类必须自己创建自己的唯一实例、单例类必须给所有其他对象提供这一实例。单例模式为一个面向对象的应用程序提供了对象惟一的访问点，不管它实现何种功能，整个应用程序都会同享一个实例对象。</li>
<li><strong>工厂模式：</strong>工厂模式主要是为创建对象提供过渡接口，以便将创建对象的具体过程屏蔽隔离起来，达到提高灵活性的目的。</li>
<li><strong>对象池模式：</strong>对象池技术在第一次创建的时候就将对象存储在一个池子中，当需要销毁的时候不直接销毁而是隐藏，当需要时在再次使用，就不需要再次实例化一个新的对象，直接把隐藏的对象显示并拿出来用。如果对象池中已经被隐藏的物体太久没有被重新使用，应该被真正的销毁。</li>
<li><strong>外观模式：</strong>外观模式中，一个子系统的外部与其内部的通信通过一个统一的外观类进行，外观类将客户类与子系统的内部复杂性分隔开，使得客户类只需要与外观角色打交道，而不需要与子系统内部的很多对象打交道。</li>
<li><strong>中介者模式：</strong>中介者模式是一种比较常用的模式,一个中介者对象封装一系列的对象交互，中介者使各对象不需要显示地相互作用，从而使耦合松散，而且可以独立地改变它们之间的交互。</li>
<li><strong>建造者模式**</strong>：**建造者模式是将一个复杂的对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</li>
<li><strong>责任链模式：</strong>责任链模式使多个对象都有机会处理请求，从而避免请求的发送者和接受者之间的耦合关系，将这个对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理他为止。</li>
</ol>
<h2 id="4-2-玩法机制"><a href="#4-2-玩法机制" class="headerlink" title="4.2 玩法机制"></a>4.2 玩法机制</h2><p>游戏初始状态下玩家拥有<code>800枚金币</code>，且有<code>10点生命值</code>。当玩家金币不足以建塔时玩家可以通过击杀病毒或打开场景中的道具来获得金币；病毒每个成功入侵玩家的生命值将会减少1点，生命值为0则游戏失败并结束。当玩家成功击退所有波次的病毒则获胜。</p>
<p><strong>- 病毒等级数值：</strong></p>
<table>
<thead>
<tr>
<th align="center"><strong>ID/等级</strong></th>
<th align="center"><strong>病毒</strong></th>
<th align="center"><strong>生命值</strong></th>
<th align="center"><strong>移动速度</strong></th>
<th align="center"><strong>击杀奖励</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center"><img src="image-20200519174750301.png" /></td>
<td align="center">100</td>
<td align="center">1</td>
<td align="center">50</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center"><img src="image-20200519174942440.png" /></td>
<td align="center">200</td>
<td align="center">2</td>
<td align="center">100</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center"><img src="image-20200519174945621.png" /></td>
<td align="center">300</td>
<td align="center">3</td>
<td align="center">150</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center"><img src="image-20200519174948003.png" /></td>
<td align="center">400</td>
<td align="center">4</td>
<td align="center">200</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center"><img src="image-20200519174950750.png" /></td>
<td align="center">500</td>
<td align="center">5</td>
<td align="center">250</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center"><img src="image-20200519174953130.png" /></td>
<td align="center">600</td>
<td align="center">6</td>
<td align="center">300</td>
</tr>
</tbody></table>
<p><strong>-</strong> <strong>炮塔等级数值：</strong> 根据防疫物品的特征：口罩有阻挡新冠病毒传播的能力，而84消毒液、75%医用酒精、含酒精洗手液有杀死病毒的能力。按照这些特征来设定游戏中塔的能力。</p>
<div align=center>

<p><img src="image-20200519180402292.png" alt="炮塔ID"></p>
</div>

<table>
<thead>
<tr>
<th align="center"><strong>ID</strong></th>
<th align="center"><strong>等级</strong></th>
<th align="center"><strong>建塔价格</strong></th>
<th align="center"><strong>卖出价格</strong></th>
<th align="center"><strong>攻击CD</strong></th>
<th align="center"><strong>攻击范围</strong></th>
<th align="center"><strong>攻击速度</strong></th>
<th align="center"><strong>攻击伤害</strong></th>
<th align="center"><strong>攻击Buff</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">100</td>
<td align="center">50</td>
<td align="center">1.5</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">50</td>
<td align="center">0.12</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">2</td>
<td align="center">150</td>
<td align="center">75</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">3</td>
<td align="center">60</td>
<td align="center">0.48</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">3</td>
<td align="center">225</td>
<td align="center">113</td>
<td align="center">0.8</td>
<td align="center">6</td>
<td align="center">4</td>
<td align="center">80</td>
<td align="center">1.08</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">120</td>
<td align="center">60</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">50</td>
<td align="center">0.12</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">2</td>
<td align="center">180</td>
<td align="center">90</td>
<td align="center">0.8</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">60</td>
<td align="center">0.48</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">3</td>
<td align="center">270</td>
<td align="center">135</td>
<td align="center">0.6</td>
<td align="center">6</td>
<td align="center">5</td>
<td align="center">100</td>
<td align="center">1.08</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">140</td>
<td align="center">70</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">5</td>
<td align="center">50</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">2</td>
<td align="center">150</td>
<td align="center">75</td>
<td align="center">1.5</td>
<td align="center">4</td>
<td align="center">6</td>
<td align="center">60</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">3</td>
<td align="center">225</td>
<td align="center">136</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">80</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">160</td>
<td align="center">80</td>
<td align="center">1.5</td>
<td align="center">2</td>
<td align="center">6</td>
<td align="center">70</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">2</td>
<td align="center">240</td>
<td align="center">120</td>
<td align="center">1.1</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">80</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">3</td>
<td align="center">360</td>
<td align="center">180</td>
<td align="center">0.9</td>
<td align="center">6</td>
<td align="center">7</td>
<td align="center">100</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">160</td>
<td align="center">80</td>
<td align="center">1.2</td>
<td align="center">7</td>
<td align="center">2</td>
<td align="center">70</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">2</td>
<td align="center">240</td>
<td align="center">120</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">3</td>
<td align="center">80</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">3</td>
<td align="center">360</td>
<td align="center">180</td>
<td align="center">0.8</td>
<td align="center">9</td>
<td align="center">4</td>
<td align="center">90</td>
<td align="center">-</td>
</tr>
</tbody></table>
<p><em>（buff为减速buff，表中的buff值由减速大小×减速时长的结果）</em></p>
<p><strong>-</strong> <strong>道具：</strong>游戏中道具的血量为800，打开道具后可获得1000金币的奖励，并且原来被道具占据的位置也可进行建塔操作。</p>
<p><strong>-</strong> <strong>集火：</strong>玩家可选定集火目标，目标可以是病毒和道具。选定目标后在防御塔的攻击范围内的塔会对目标进行集火攻击。</p>
<p><strong>-</strong> <strong>自动攻击：</strong>防御塔会自动攻击并跟踪进入其攻击范围内的病毒，可以通过升级塔来扩大攻击范围等能力。</p>
<p><strong>-</strong> <strong>防御塔操作：</strong>玩家可以在规定区域内建塔，其中道具所在位置和怪物入侵道路不可建塔。点击需要建塔的位置将展开建塔列表，再次点击可以收起建塔列表。点击已建的防御塔可以查看该塔目前是否可以升级，同时也可以看到塔的攻击范围。此外，玩家可以点击暂停后进行建塔，建塔完成后再点击继续。</p>
<p><strong>-</strong> <strong>病毒入侵：</strong>每波病毒只会在上一波病毒以完全消灭/成功入侵后开始入侵。</p>
<h1 id="5-UML图"><a href="#5-UML图" class="headerlink" title="5. UML图"></a>5. UML图</h1><div align=center>

<img src="UML1.svg" alt="UML1" style="zoom:80%;" />

<img src="UML2.svg" alt="UML2" style="zoom:80%;" />

<img src="UML3.svg" alt="UML3" style="zoom:80%;" />

<img src="UML4.svg" alt="UML4" style="zoom:80%;" />

<img src="UML5.svg" alt="UML5" style="zoom:80%;" />

</div>

<h1 id="6-UI部分技术总结"><a href="#6-UI部分技术总结" class="headerlink" title="6. UI部分技术总结"></a>6. UI部分技术总结</h1><p>因为整个游戏项目的代码比较多，所以就只总结一些复用性比较高的部分内容。</p>
<h2 id="6-1-DoTween插件的缓动函数"><a href="#6-1-DoTween插件的缓动函数" class="headerlink" title="6.1 DoTween插件的缓动函数"></a>6.1 DoTween插件的缓动函数</h2><p>本游戏使用 DoTween插件来配置UI动画，缓动函数指定动画效果在执行时的速度，用于控制动画从初始值运动到最终值的速率。</p>
<p>DoTween的其他内容在上一篇文章已经总结过了，这里就不再赘述了。</p>
<h2 id="6-2-Scroll-Rect组件"><a href="#6-2-Scroll-Rect组件" class="headerlink" title="6.2 Scroll Rect组件"></a>6.2 Scroll Rect组件</h2><p>游戏中的帮助页面与选择关卡界面都使用了<code>Scroll View 组件</code>。在Scroll View中，当需要在小区域显示占用大量空间的内容时，可以使用<code>Scroll Rect</code>。滚动矩形提供了滚动浏览此内容的功能。</p>
<ul>
<li>Content：这是对用户界面要滚动的元素，例如大图像。</li>
<li>Horizontal/ Vertical：启用水平/垂直滚动。</li>
<li>Movement Type：无限制，弹性或夹紧。使用“弹性”或“夹紧”可将内容强制保留在“滚动矩形”的范围内。弹性模式在到达滚动矩形的边缘时会反弹内容。</li>
<li>Elasticity：弹性模式下使用的弹跳量。</li>
<li>Inertia：设置惯性后，拖动鼠标后释放指针，内容将继续移动。如果未设置惯性，则内容仅在拖动时才会移动。<strong>当使用DoTween插件来配置滚动动画时会产生冲突，需要关闭该选项。</strong></li>
<li>Deceleration Rate：设置惯性后，减速率将决定对象停止移动的速度。0将立即停止运动。值为1表示运动永远不会减速。</li>
<li>Scroll Sensitivity：对滚轮和触控板滚动事件的敏感性。</li>
<li>Viewport：引用作为内容Rect变换父级的视口Rect变换。</li>
<li>Scrollbar：对滚动条元素的可选引用，可以设置滚动条的隐藏属性和滚动条与视口的空间大小。</li>
</ul>
<h2 id="6-3-GridLayoutGroup组件"><a href="#6-3-GridLayoutGroup组件" class="headerlink" title="6.3 GridLayoutGroup组件"></a>6.3 GridLayoutGroup组件</h2><p>游戏中的帮助页面与选择关卡界面都使用了Scroll View 组件。在Scroll View的Content中通常会使用GridLayoutGroup组件来使内容的填充更有序。</p>
<ul>
<li>Cell Size：Content中每个单位的宽高；</li>
<li>Spacing：每个单位的间隔；</li>
<li>Start Corner：开始的位置，如Upper Left则为从左上角开始排列；</li>
<li>Start Axis：排列形式，分为水平排列和垂直排列；</li>
<li>Child Alignment：排列方式，如Upper Center则为居中靠上排列；</li>
<li>Constraint：约束，可选择行约束、列约束和无约束；</li>
<li>Padding：Content整体偏移量。</li>
</ul>
<h2 id="6-4-翻页效果的实现思路"><a href="#6-4-翻页效果的实现思路" class="headerlink" title="6.4 翻页效果的实现思路"></a>6.4 翻页效果的实现思路</h2><p>游戏中的帮助页面与选择关卡界面都需要实现翻页效果。是要翻一页或者多页，使用的方法是让ScrollView用它自身长度的单位化比例来实现。为实现这个需求我们首先需要：</p>
<p>①content的总长</p>
<p>②玩家鼠标的开始位置与结束位置，并根据开始滑动与结束滑动的事件方式计算差值。若开始位置-结束位置&gt;0，则右滑；若开始位置-结束位置&lt;0，则左滑。通过差值来决定滑动几个单元格。</p>
<p>③移动一个单元格玩家鼠标需要滑动的距离<strong>（一个单元格长度+左偏移量）</strong>。</p>
<p>④移动多个单元格玩家鼠标需要滑动的距离。其中<strong>第一个是单元格长度+左偏移量，之后的每一个滑动都是单元格长度+间隔。</strong></p>
<p>⑤滑动一个单元格所占的比例，可通过<strong>一个单元格所在位置中点的长度/Content的总长度</strong>得到。其中上限值与下限值为防止超过我们的最小长度与最大长度。</p>
<p>最后，可以推算出Content宽度与单元格长度与数量的<code>关系式</code>：</p>
<p><strong>宽度=原来的宽度+（每一个单元格长度+间隙）*（单元格数量-1）</strong></p>
<h2 id="6-5-单页效果的实现"><a href="#6-5-单页效果的实现" class="headerlink" title="6.5 单页效果的实现"></a>6.5 单页效果的实现</h2><p>本游戏中，翻页效果的实现分为<code>单页效果</code>（每次只能滑动一个页面）和<code>多页效果</code>（一次可以滑动多个页面）。其中单页效果通过使用<strong>改变局部坐标</strong>的方法实现脚本的成员变量来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line">using UnityEngine.EventSystems;</span><br><span class="line">using DG.Tweening;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">&#x2F;&#x2F;&#x2F; 单滑</span><br><span class="line">&#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">public class SlideScrollView : MonoBehaviour,IBeginDragHandler,IEndDragHandler &#123;</span><br><span class="line"></span><br><span class="line">    private RectTransform contentTrans;</span><br><span class="line">    private float beginMousePositionX;</span><br><span class="line">    private float endMousePositionX;</span><br><span class="line">    private ScrollRect scrollRect;</span><br><span class="line"></span><br><span class="line">    public int cellLength;</span><br><span class="line">    public int spacing;</span><br><span class="line">    public int leftOffset;</span><br><span class="line">    private float moveOneItemLength;</span><br><span class="line"></span><br><span class="line">    private Vector3 currentContentLocalPos;&#x2F;&#x2F;上一次的位置</span><br><span class="line">    private Vector3 contentInitPos;&#x2F;&#x2F;Content初始位置</span><br><span class="line">    private Vector2 contentTransSize;&#x2F;&#x2F;Content初始大小</span><br><span class="line"></span><br><span class="line">    public int totalItemNum;</span><br><span class="line">    private int currentIndex;</span><br><span class="line"></span><br><span class="line">    public Text pageText;</span><br><span class="line"></span><br><span class="line">    public bool needSendMessage;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        scrollRect &#x3D; GetComponent&lt;ScrollRect&gt;();</span><br><span class="line">        contentTrans &#x3D; scrollRect.content;</span><br><span class="line">        moveOneItemLength &#x3D; cellLength + spacing;</span><br><span class="line">        currentContentLocalPos &#x3D; contentTrans.localPosition;</span><br><span class="line">        contentTransSize &#x3D; contentTrans.sizeDelta;</span><br><span class="line">        contentInitPos &#x3D; contentTrans.localPosition;</span><br><span class="line">        currentIndex &#x3D; 1;</span><br><span class="line">        if (pageText !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Init()</span><br><span class="line">    &#123;</span><br><span class="line">        currentIndex &#x3D; 1;</span><br><span class="line">       </span><br><span class="line">        if (contentTrans!&#x3D;null)</span><br><span class="line">        &#123;</span><br><span class="line">            contentTrans.localPosition &#x3D; contentInitPos;</span><br><span class="line">            currentContentLocalPos &#x3D; contentInitPos;</span><br><span class="line">            if (pageText !&#x3D; null)</span><br><span class="line">            &#123;</span><br><span class="line">                pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 通过拖拽与松开来达成翻页效果</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;param name&#x3D;&quot;eventData&quot;&gt;&lt;&#x2F;param&gt;</span><br><span class="line"></span><br><span class="line">    public void OnEndDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">        endMousePositionX &#x3D; Input.mousePosition.x;</span><br><span class="line">        float offSetX &#x3D; 0;</span><br><span class="line">        float moveDistance &#x3D; 0;&#x2F;&#x2F;当次需要滑动的距离</span><br><span class="line">        offSetX &#x3D; beginMousePositionX - endMousePositionX;</span><br><span class="line"></span><br><span class="line">        if (offSetX&gt;0)&#x2F;&#x2F;右滑</span><br><span class="line">        &#123;</span><br><span class="line">            if (currentIndex&gt;&#x3D;totalItemNum)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            if (needSendMessage)</span><br><span class="line">            &#123;</span><br><span class="line">                UpdatePanel(true);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            moveDistance &#x3D; -moveOneItemLength;</span><br><span class="line">            currentIndex++;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#x2F;&#x2F;左滑</span><br><span class="line">        &#123;</span><br><span class="line">            if (currentIndex&lt;&#x3D;1)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            if (needSendMessage)</span><br><span class="line">            &#123;</span><br><span class="line">                UpdatePanel(false);</span><br><span class="line">            &#125;</span><br><span class="line">            moveDistance &#x3D; moveOneItemLength;</span><br><span class="line">            currentIndex--;</span><br><span class="line">        &#125;</span><br><span class="line">        if (pageText !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">        &#125;</span><br><span class="line">        DOTween.To(()&#x3D;&gt;contentTrans.localPosition,lerpValue&#x3D;&gt;contentTrans.localPosition&#x3D;lerpValue,currentContentLocalPos+new Vector3(moveDistance,0,0),0.5f).SetEase(Ease.OutQuint);</span><br><span class="line">        currentContentLocalPos +&#x3D; new Vector3(moveDistance, 0, 0);</span><br><span class="line">        &#x2F;&#x2F;只能存在于此项目</span><br><span class="line">        GameManager.Instance.audioSourceManager.PlayPagingAudioClip();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 按钮来控制翻书效果</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line"></span><br><span class="line">    public void ToNextPage()</span><br><span class="line">    &#123;</span><br><span class="line">        float moveDistance &#x3D; 0;</span><br><span class="line">        if (currentIndex&gt;&#x3D;totalItemNum)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        moveDistance &#x3D; -moveOneItemLength;</span><br><span class="line">        currentIndex++;</span><br><span class="line">        if (pageText!&#x3D;null)</span><br><span class="line">        &#123;</span><br><span class="line">            pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">        &#125;</span><br><span class="line">        if (needSendMessage)</span><br><span class="line">        &#123;</span><br><span class="line">            UpdatePanel(true);</span><br><span class="line">        &#125;</span><br><span class="line">        DOTween.To(() &#x3D;&gt; contentTrans.localPosition, lerpValue &#x3D;&gt; contentTrans.localPosition &#x3D; lerpValue, currentContentLocalPos + new Vector3(moveDistance, 0, 0), 0.5f).SetEase(Ease.OutQuint);</span><br><span class="line">        currentContentLocalPos +&#x3D; new Vector3(moveDistance, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void ToLastPage()</span><br><span class="line">    &#123;</span><br><span class="line">        float moveDistance &#x3D; 0;</span><br><span class="line">        if (currentIndex &lt;&#x3D;1)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        moveDistance &#x3D; moveOneItemLength;</span><br><span class="line">        currentIndex--;</span><br><span class="line">        if (pageText !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">        &#125;</span><br><span class="line">        if (needSendMessage)</span><br><span class="line">        &#123;</span><br><span class="line">            UpdatePanel(false);</span><br><span class="line">        &#125;</span><br><span class="line">        DOTween.To(() &#x3D;&gt; contentTrans.localPosition, lerpValue &#x3D;&gt; contentTrans.localPosition &#x3D; lerpValue, currentContentLocalPos + new Vector3(moveDistance, 0, 0), 0.5f).SetEase(Ease.OutQuint);</span><br><span class="line">        currentContentLocalPos +&#x3D; new Vector3(moveDistance, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void OnBeginDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">        beginMousePositionX &#x3D; Input.mousePosition.x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;设置Content的大小</span><br><span class="line">    public void SetContentLength(int itemNum)</span><br><span class="line">    &#123;</span><br><span class="line">        contentTrans.sizeDelta &#x3D; new Vector2(contentTrans.sizeDelta.x+(cellLength+spacing)*(itemNum-1),contentTrans.sizeDelta.y);</span><br><span class="line">        totalItemNum &#x3D; itemNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;初始化Content的大小</span><br><span class="line">    public void InitScrollLength()</span><br><span class="line">    &#123;</span><br><span class="line">        contentTrans.sizeDelta &#x3D; contentTransSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;发送翻页信息的方法</span><br><span class="line">    public void UpdatePanel(bool toNext)</span><br><span class="line">    &#123;</span><br><span class="line">        if (toNext)</span><br><span class="line">        &#123;</span><br><span class="line">            gameObject.SendMessageUpwards(&quot;ToNextLevel&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            gameObject.SendMessageUpwards(&quot;ToLastLevel&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-6-多页效果的实现"><a href="#6-6-多页效果的实现" class="headerlink" title="6.6 多页效果的实现"></a>6.6 多页效果的实现</h2><p>本游戏中，翻页效果的实现分为<code>单页效果</code>（每次只能滑动一个页面）和<code>多页效果</code>（一次可以滑动多个页面）。其中多页效果通过使用<strong>比例</strong>方法来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line">using UnityEngine.EventSystems;</span><br><span class="line">using DG.Tweening;</span><br><span class="line"></span><br><span class="line">public class SlideCanCoverScrollView : MonoBehaviour,IBeginDragHandler,IEndDragHandler &#123;</span><br><span class="line"></span><br><span class="line">    private float contentLength;&#x2F;&#x2F;容器长度</span><br><span class="line">    private float beginMousePostionX;</span><br><span class="line">    private float endMousePositionX;</span><br><span class="line">    private ScrollRect scrollRect;</span><br><span class="line">    private float lastProportion;&#x2F;&#x2F;上一个位置比例</span><br><span class="line"></span><br><span class="line">    public int cellLength;&#x2F;&#x2F;每个单元格长度</span><br><span class="line">    public int spacing;&#x2F;&#x2F;间隙</span><br><span class="line">    public int leftOffset;&#x2F;&#x2F;左偏移量</span><br><span class="line">    private float upperLimit;&#x2F;&#x2F;上限值</span><br><span class="line">    private float lowerLimit;&#x2F;&#x2F;下限值</span><br><span class="line">    private float firstItemLength;&#x2F;&#x2F;移动第一个单元格的距离</span><br><span class="line">    private float oneItemLength;&#x2F;&#x2F;滑动一个单元格需要的距离</span><br><span class="line">    private float oneItemProportion;&#x2F;&#x2F;滑动一个单元格所占比例</span><br><span class="line"></span><br><span class="line">    public int totalItemNum;&#x2F;&#x2F;共有几个单元格</span><br><span class="line">    private int currentIndex;&#x2F;&#x2F;当前单元格索引</span><br><span class="line"></span><br><span class="line">    public Text pageText;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        scrollRect &#x3D; GetComponent&lt;ScrollRect&gt;();</span><br><span class="line">        contentLength &#x3D; scrollRect.content.rect.xMax - 2 * leftOffset - cellLength;</span><br><span class="line">        firstItemLength &#x3D; cellLength &#x2F; 2 + leftOffset;</span><br><span class="line">        oneItemLength &#x3D; cellLength + spacing;</span><br><span class="line">        oneItemProportion &#x3D; oneItemLength &#x2F; contentLength;</span><br><span class="line">        upperLimit&#x3D;1- firstItemLength &#x2F; contentLength;</span><br><span class="line">        lowerLimit &#x3D; firstItemLength &#x2F; contentLength;</span><br><span class="line">        currentIndex &#x3D; 1;</span><br><span class="line">        scrollRect.horizontalNormalizedPosition &#x3D; 0;</span><br><span class="line">        if (pageText !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Init()</span><br><span class="line">    &#123;           </span><br><span class="line">        lastProportion &#x3D; 0;</span><br><span class="line">        currentIndex &#x3D; 1;</span><br><span class="line">        if (scrollRect !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            scrollRect.horizontalNormalizedPosition &#x3D; 0;</span><br><span class="line">            pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    public void OnEndDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">        float offSetX &#x3D; 0;</span><br><span class="line">        endMousePositionX &#x3D; Input.mousePosition.x;</span><br><span class="line">        offSetX &#x3D; (beginMousePostionX - endMousePositionX)*2;</span><br><span class="line">        &#x2F;&#x2F;Debug.Log(&quot;offSetX:&quot; + offSetX);</span><br><span class="line">        &#x2F;&#x2F;Debug.Log(&quot;firstItemLength:&quot; + firstItemLength);</span><br><span class="line">        if (Mathf.Abs(offSetX)&gt;firstItemLength)&#x2F;&#x2F;执行滑动动作的前提是要大于第一个需要滑动的距离</span><br><span class="line">        &#123;</span><br><span class="line">            if (offSetX&gt;0)&#x2F;&#x2F;右滑</span><br><span class="line">            &#123;</span><br><span class="line">                if (currentIndex&gt;&#x3D;totalItemNum)</span><br><span class="line">                &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                int moveCount &#x3D; </span><br><span class="line">                    (int)((offSetX - firstItemLength) &#x2F; oneItemLength) + 1;&#x2F;&#x2F;当次可以移动的格子数目</span><br><span class="line">                currentIndex +&#x3D; moveCount;</span><br><span class="line">                if (currentIndex&gt;&#x3D;totalItemNum)</span><br><span class="line">                &#123;</span><br><span class="line">                    currentIndex &#x3D; totalItemNum;</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;当次需要移动的比例:上一次已经存在的单元格位置</span><br><span class="line">                &#x2F;&#x2F;的比例加上这一次需要去移动的比例</span><br><span class="line">                lastProportion +&#x3D; oneItemProportion * moveCount;</span><br><span class="line">                if (lastProportion&gt;&#x3D;upperLimit)</span><br><span class="line">                &#123;</span><br><span class="line">                    lastProportion &#x3D; 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else &#x2F;&#x2F;左滑</span><br><span class="line">            &#123;</span><br><span class="line">                if (currentIndex &lt;&#x3D;1)</span><br><span class="line">                &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                int moveCount &#x3D;</span><br><span class="line">                    (int)((offSetX + firstItemLength) &#x2F; oneItemLength) - 1;&#x2F;&#x2F;当次可以移动的格子数目</span><br><span class="line">                currentIndex +&#x3D; moveCount;</span><br><span class="line">                if (currentIndex &lt;&#x3D;1)</span><br><span class="line">                &#123;</span><br><span class="line">                    currentIndex &#x3D; 1;</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;当次需要移动的比例:上一次已经存在的单元格位置</span><br><span class="line">                &#x2F;&#x2F;的比例加上这一次需要去移动的比例</span><br><span class="line">                lastProportion +&#x3D; oneItemProportion * moveCount;</span><br><span class="line">                if (lastProportion &lt;&#x3D; lowerLimit)</span><br><span class="line">                &#123;</span><br><span class="line">                    lastProportion &#x3D; 0;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (pageText!&#x3D;null)</span><br><span class="line">            &#123;</span><br><span class="line">                pageText.text &#x3D; currentIndex.ToString() + &quot;&#x2F;&quot; + totalItemNum;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        DOTween.To(() &#x3D;&gt; scrollRect.horizontalNormalizedPosition, lerpValue &#x3D;&gt; scrollRect.horizontalNormalizedPosition &#x3D; lerpValue, lastProportion, 0.5f).SetEase(Ease.OutQuint);</span><br><span class="line">        GameManager.Instance.audioSourceManager.PlayPagingAudioClip();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void OnBeginDrag(PointerEventData eventData)</span><br><span class="line">    &#123;</span><br><span class="line">        beginMousePostionX &#x3D; Input.mousePosition.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-7-UI实例化"><a href="#6-7-UI实例化" class="headerlink" title="6.7 UI实例化"></a>6.7 UI实例化</h2><p>游戏中需要不断地将不同的UIPanel实例化到<code>Canvas</code>下进行显示。但是由于使用工厂模式，<em>在实例化时会遇到UIPanel先实例化到Hierarchy中再设置其父对象。此时UIPanel的锚点就不是以Canvas的大小为准。</em></p>
<p><strong>解决这个问题可以通过将锚点由原来的“包裹父对象”更改为“居中显示”，并在实例化时在设置其父对象为Canvas后将对应Panel的Pos改为0，Scale改为1即可解决。</strong></p>
<p>UIPanel通过添加到UI管理字典，实例化当前场景所有面板，并存入字典。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;实例化当前场景所有面板，并存入字典</span><br><span class="line">public void InitDict()</span><br><span class="line">&#123;</span><br><span class="line">    foreach (var item in mUIManager.currentScenePanelDict)</span><br><span class="line">    &#123;</span><br><span class="line">        item.Value.transform.SetParent(canvasTransform);</span><br><span class="line">        item.Value.transform.localPosition &#x3D; Vector3.zero;</span><br><span class="line">        item.Value.transform.localScale &#x3D; Vector3.one;</span><br><span class="line">        IBasePanel basePanel &#x3D; item.Value.GetComponent&lt;IBasePanel&gt;();</span><br><span class="line">        if (basePanel &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(&quot;获取面板上IBasePanel脚本失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        basePanel.InitPanel();</span><br><span class="line">        &#x2F;&#x2F;Debug.Log(item.Key);</span><br><span class="line">        currentScenePanelDict.Add(item.Key, basePanel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;清空UIPanel字典</span><br><span class="line">public void ClearDict()</span><br><span class="line">&#123;</span><br><span class="line">    currentScenePanelDict.Clear();</span><br><span class="line">    mUIManager.ClearDict();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;添加UIPanel到UIManager字典</span><br><span class="line">public void AddPanelToDict(string uiPanelName)</span><br><span class="line">&#123;</span><br><span class="line">    mUIManager.currentScenePanelDict.Add(uiPanelName, GetGameObjectResource(FactoryType.UIPanelFactory, uiPanelName));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-8-克隆体名称问题与字符串截取"><a href="#6-8-克隆体名称问题与字符串截取" class="headerlink" title="6.8 克隆体名称问题与字符串截取"></a>6.8 克隆体名称问题与字符串截取</h2><p>游戏中实例化对象时，Instance方法会使用Perfabs的克隆体。因此实例化的对象会有(Clone)的后缀，在将对象放回对象池时会产生报空操作。解决这个问题的方法只需要对对象的名称进行截取，使用Substring()函数即可解决。</p>
<p>Substring的使用方法有两种：</p>
<ul>
<li>一是<strong>Substring(int startIndex)</strong> ，子字符串从指定的字符位置（第startIndex个字符）开始，一直到此字符串末尾。</li>
<li>二是<strong>Substring(int startIndex, int length)</strong>，子字符串从指定的字符位置第startIndex个字符）开始，且具有指定的长度（子字符串的长度length）。</li>
</ul>
<h2 id="6-9-控制渲染顺序"><a href="#6-9-控制渲染顺序" class="headerlink" title="6.9 控制渲染顺序"></a>6.9 控制渲染顺序</h2><p>游戏中直接通过工厂实例化的对象的渲染顺序会出现错误的遮挡关系，可以通过Transform.SetSiblingIndex(i)来控制渲染顺序。<strong>I越大则对象越后渲染。</strong></p>
<h2 id="6-10-主面板的左右移动动画"><a href="#6-10-主面板的左右移动动画" class="headerlink" title="6.10 主面板的左右移动动画"></a>6.10 主面板的左右移动动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using DG.Tweening;</span><br><span class="line"></span><br><span class="line">public class MainPanel : BasePanel &#123;</span><br><span class="line">    </span><br><span class="line">    private Tween[] mainPanelTween;&#x2F;&#x2F;0.右，1.左</span><br><span class="line">    private Tween ExitTween;&#x2F;&#x2F;离开主页运行的动画</span><br><span class="line"></span><br><span class="line">    protected override void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        base.Awake();</span><br><span class="line">        &#x2F;&#x2F;获取成员变量</span><br><span class="line">        transform.SetSiblingIndex(8);</span><br><span class="line"></span><br><span class="line">        mainPanelTween &#x3D; new Tween[2];</span><br><span class="line">        mainPanelTween[0] &#x3D; transform.DOLocalMoveX(1920, 0.5f);</span><br><span class="line">        mainPanelTween[0].SetAutoKill(false);</span><br><span class="line">        mainPanelTween[0].Pause();</span><br><span class="line">        mainPanelTween[1] &#x3D; transform.DOLocalMoveX(-1920, 0.5f);</span><br><span class="line">        mainPanelTween[1].SetAutoKill(false);</span><br><span class="line">        mainPanelTween[1].Pause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void EnterPanel()</span><br><span class="line">    &#123;</span><br><span class="line">        transform.SetSiblingIndex(8);</span><br><span class="line">        if (ExitTween !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            ExitTween.PlayBackwards();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void ExitPanel()</span><br><span class="line">    &#123;</span><br><span class="line">        ExitTween.PlayForward();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void MoveToRight()</span><br><span class="line">    &#123;</span><br><span class="line">        mUIFacade.PlayButtonAudioClip();</span><br><span class="line">        ExitTween &#x3D; mainPanelTween[0];</span><br><span class="line">        mUIFacade.currentScenePanelDict[StringManager.SetPanel].EnterPanel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void MoveToLeft()</span><br><span class="line">    &#123;</span><br><span class="line">        mUIFacade.PlayButtonAudioClip();</span><br><span class="line">        ExitTween &#x3D; mainPanelTween[1];</span><br><span class="line">        mUIFacade.currentScenePanelDict[StringManager.HelpPanel].EnterPanel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F;&#x2F;场景状态切换的方法</span><br><span class="line"></span><br><span class="line">    public void ToNormalModelScene()</span><br><span class="line">    &#123;</span><br><span class="line">        mUIFacade.PlayButtonAudioClip();</span><br><span class="line">        mUIFacade.currentScenePanelDict[StringManager.GameLoadPanel].EnterPanel();</span><br><span class="line">        mUIFacade.ChangeSceneState(new NormalGameOptionSceneState(mUIFacade));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-11-帮助面板的页面切换"><a href="#6-11-帮助面板的页面切换" class="headerlink" title="6.11 帮助面板的页面切换"></a>6.11 帮助面板的页面切换</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using DG.Tweening;</span><br><span class="line">using UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line">public class HelpPanel : BasePanel &#123;</span><br><span class="line"></span><br><span class="line">    private GameObject helpPageGo;</span><br><span class="line">    private GameObject covidPageGo;</span><br><span class="line">    private GameObject defendPageGo;</span><br><span class="line">    private SlideScrollView slideScrollView;</span><br><span class="line">    private Tween helpPanelTween;</span><br><span class="line">    protected override void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        base.Awake();</span><br><span class="line">        helpPageGo &#x3D; transform.Find(&quot;HelpPage&quot;).gameObject;</span><br><span class="line">        covidPageGo &#x3D; transform.Find(&quot;CovidPage&quot;).gameObject;</span><br><span class="line">        defendPageGo &#x3D; transform.Find(&quot;DefendPage&quot;).gameObject;</span><br><span class="line">        slideScrollView &#x3D; transform.Find(&quot;HelpPage&quot;).Find(&quot;Scroll View&quot;).GetComponent&lt;SlideScrollView&gt;();</span><br><span class="line">        helpPanelTween &#x3D; transform.DOLocalMoveX(0, 0.5f);</span><br><span class="line">        helpPanelTween.SetAutoKill(false);</span><br><span class="line">        helpPanelTween.Pause();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;显示页面的方法</span><br><span class="line">    public void ShowHelpPage()</span><br><span class="line">    &#123;</span><br><span class="line">        if (!helpPageGo.activeSelf)</span><br><span class="line">        &#123;</span><br><span class="line">            mUIFacade.PlayButtonAudioClip();</span><br><span class="line">            helpPageGo.SetActive(true);</span><br><span class="line">        &#125;</span><br><span class="line">        covidPageGo.SetActive(false);</span><br><span class="line">        defendPageGo.SetActive(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void ShowCovidPage()</span><br><span class="line">    &#123;</span><br><span class="line">        mUIFacade.PlayButtonAudioClip();</span><br><span class="line">        helpPageGo.SetActive(false);</span><br><span class="line">        covidPageGo.SetActive(true);</span><br><span class="line">        defendPageGo.SetActive(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void ShowDefendPage()</span><br><span class="line">    &#123;</span><br><span class="line">        mUIFacade.PlayButtonAudioClip();</span><br><span class="line">        helpPageGo.SetActive(false);</span><br><span class="line">        covidPageGo.SetActive(false);</span><br><span class="line">        defendPageGo.SetActive(true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;处理面板的方法</span><br><span class="line"></span><br><span class="line">    public override void InitPanel()</span><br><span class="line">    &#123;</span><br><span class="line">        base.InitPanel();</span><br><span class="line"></span><br><span class="line">        transform.SetSiblingIndex(5);</span><br><span class="line">        </span><br><span class="line">        slideScrollView.Init();</span><br><span class="line">        ShowHelpPage();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;其他处理</span><br><span class="line">        if (transform.localPosition &#x3D;&#x3D; Vector3.zero)</span><br><span class="line">        &#123;</span><br><span class="line">            gameObject.SetActive(false);</span><br><span class="line">            helpPanelTween.PlayBackwards();</span><br><span class="line">        &#125;</span><br><span class="line">        transform.localPosition &#x3D; new Vector3(1920, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void EnterPanel()</span><br><span class="line">    &#123;</span><br><span class="line">        base.EnterPanel();</span><br><span class="line">        gameObject.SetActive(true);</span><br><span class="line">        slideScrollView.Init();</span><br><span class="line">        MoveToCenter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void ExitPanel()</span><br><span class="line">    &#123;</span><br><span class="line">        base.ExitPanel();</span><br><span class="line">        mUIFacade.PlayButtonAudioClip();</span><br><span class="line">        &#x2F;&#x2F;选择场景</span><br><span class="line">        if (mUIFacade.currentSceneState.GetType() &#x3D;&#x3D; typeof(NormalGameOptionSceneState))</span><br><span class="line">        &#123;</span><br><span class="line">            mUIFacade.ChangeSceneState(new MainSceneState(mUIFacade));</span><br><span class="line">            SceneManager.LoadScene(1);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#x2F;&#x2F;如果是在主场景</span><br><span class="line">        &#123;</span><br><span class="line">            helpPanelTween.PlayBackwards();</span><br><span class="line">            mUIFacade.currentScenePanelDict[StringManager.MainPanel].EnterPanel();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void MoveToCenter()</span><br><span class="line">    &#123;</span><br><span class="line">        helpPanelTween.PlayForward();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-制图工具的实现"><a href="#7-制图工具的实现" class="headerlink" title="7. 制图工具的实现"></a>7. 制图工具的实现</h1><p>为了能过在工程中更方便快捷的开发游戏关卡地图，自定义了一个制图工具并使用宏<code>（Tool）</code>来将工具代码和游戏<code>（Game）</code>代码进行区分。将游戏场景划为6行12列，并将绘制好的地图保存为json文件。</p>
<div align=center>

<p><img src="image-20200519182550972.png" alt="地图编辑"></p>
</div>

<p>单击地图中的格子将该位置设为不可建塔区域，按住P键单击地图中的格子将该位置设为病毒入侵路径（路径按照点击顺序，只需要在起始点和转角区域点击即可），按住I键单击地图中的格子将该位置设为道具位置，多次点击可以切换道具（道具1占据1格，道具2占据2格，道具3占据4格）。</p>
<div align=center>

<p><img src="image-20200519182614903.png" alt="地图编辑工具"></p>
</div>

<p>Level为当前编辑的地图关卡，可手动设置。Round Info List为病毒波次以及每波怪物的设置。编辑完当前关卡的地图后可点击“保存当前关卡数据”将关卡数据保存为json文件，保存后的关卡数据可以再次读取编辑。</p>
<h1 id="8-游戏主逻辑"><a href="#8-游戏主逻辑" class="headerlink" title="8. 游戏主逻辑"></a>8. 游戏主逻辑</h1><h2 id="8-1-产怪逻辑"><a href="#8-1-产怪逻辑" class="headerlink" title="8.1 产怪逻辑"></a>8.1 产怪逻辑</h2><ol>
<li>Level对象控制round责任链的执行。</li>
<li>具体产怪的逻辑是通过round去执行的，round里存有本回合需要产生的怪物数量与ID，之后会把这些内容传入GameController去调用Invoke方法延时。</li>
<li>循环产生病毒。(把产怪方法封装在CameContoller里，而不是直接在round里去完成这个方法的原因:①需要延时循坏调用方法InvokeRepeating，它是Mono里的方法。②很多游戏逻辑类与信息存贮在了GameController里，所以我们必须这样去设计)。</li>
<li>但在生成病毒的时候，会出现玩家暂停产生病毒去建塔的情况，所以需要通过调用GameController的停止方法去停止延时调用。并且需要随时去打开。因此将暂停开关的监听放在Update方法里。</li>
<li>每次调用产怪方法的时候都需要去判断一下当前产怪是否完成当次回合的产怪总数，完成则停止。否则让产怪索引去累加。</li>
<li>即时监听玩家的杀怪数量。如果杀怪数量一旦等于当次回合怪物的总数，便调用level里的有关方法、把当前任务交给责任链的下一环，即进入下一个回合。每次调用Level有关方法的时候会判断责任链是否到达最后一环，如果到达，则显示最后一波有关逻辑，如果超过，则游戏胜利。</li>
</ol>
<h2 id="8-2-炮塔搜索目标的有关逻辑"><a href="#8-2-炮塔搜索目标的有关逻辑" class="headerlink" title="8.2 炮塔搜索目标的有关逻辑"></a>8.2 炮塔搜索目标的有关逻辑</h2><div align=center>

<img src="炮塔攻击逻辑.svg" alt="炮塔攻击逻辑" style="zoom:80%;" />

</div>

<h2 id="8-3-建塔列表的优化"><a href="#8-3-建塔列表的优化" class="headerlink" title="8.3 建塔列表的优化"></a>8.3 建塔列表的优化</h2><p>游戏中建塔列表如下图。如果不对其进行优化列表在<code>左边缘、右边缘和上边缘</code>都不能完整显示。同理，销售与升级按钮也有这样的问题。因此需要对建塔列表与塔操作UI进行纠正。</p>
<div align=center>

<p><img src="image-20200519182831560.png" alt="建塔列表"></p>
</div>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;纠正建塔列表的位置</span><br><span class="line">private Vector3 CorrectTowerListGoPosition()</span><br><span class="line">&#123;</span><br><span class="line">    Vector3 correctPosition &#x3D; Vector3.zero;</span><br><span class="line">    if (gridIndex.xIndex &lt;&#x3D; 3 &amp;&amp; gridIndex.xIndex &gt;&#x3D; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        correctPosition +&#x3D; new Vector3(gameController.mapMaker.gridWidth, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    else if (gridIndex.xIndex &lt;&#x3D; 11 &amp;&amp; gridIndex.xIndex &gt;&#x3D; 8)</span><br><span class="line">    &#123;</span><br><span class="line">        correctPosition -&#x3D; new Vector3(gameController.mapMaker.gridWidth, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    if (gridIndex.yIndex &lt;&#x3D; 2 &amp;&amp; gridIndex.yIndex &gt;&#x3D; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        correctPosition +&#x3D; new Vector3(0, gameController.mapMaker.gridHeight, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    else if (gridIndex.yIndex &lt;&#x3D; 5 &amp;&amp; gridIndex.yIndex &gt;&#x3D; 3)</span><br><span class="line">    &#123;</span><br><span class="line">        correctPosition -&#x3D; new Vector3(0, gameController.mapMaker.gridHeight, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    correctPosition +&#x3D; transform.position;</span><br><span class="line">    return correctPosition;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;纠正操作塔UI画布的方法(纠正按钮位置的方法)</span><br><span class="line">private void CorrectHandleTowerCanvasGoPosition()</span><br><span class="line">&#123;</span><br><span class="line">    upLevelButtonTrans.localPosition &#x3D; Vector3.zero;</span><br><span class="line">    sellTowerButtonTrans.localPosition &#x3D; Vector3.zero;</span><br><span class="line">    if (gridIndex.yIndex &lt;&#x3D; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        if (gridIndex.xIndex &#x3D;&#x3D; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            sellTowerButtonTrans.position +&#x3D; new Vector3(GameController.Instance.mapMaker.gridWidth * 3 &#x2F; 4, 0, 0);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            sellTowerButtonTrans.position -&#x3D; new Vector3(GameController.Instance.mapMaker.gridWidth * 3 &#x2F; 4, 0, 0);</span><br><span class="line">        &#125;</span><br><span class="line">        upLevelButtonTrans.localPosition &#x3D; upLevelButtonInitPos;</span><br><span class="line">    &#125;</span><br><span class="line">    else if (gridIndex.yIndex &gt;&#x3D; 4)</span><br><span class="line">    &#123;</span><br><span class="line">        if (gridIndex.xIndex &#x3D;&#x3D; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            upLevelButtonTrans.position +&#x3D; new Vector3(GameController.Instance.mapMaker.gridWidth * 3 &#x2F; 4, 0, 0);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            upLevelButtonTrans.position -&#x3D; new Vector3(GameController.Instance.mapMaker.gridWidth * 3 &#x2F; 4, 0, 0);</span><br><span class="line">        &#125;</span><br><span class="line">        sellTowerButtonTrans.localPosition &#x3D; sellTowerButtonInitPos;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        upLevelButtonTrans.localPosition &#x3D; upLevelButtonInitPos;</span><br><span class="line">        sellTowerButtonTrans.localPosition &#x3D; sellTowerButtonInitPos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-4-防御塔跟随目标朝向"><a href="#8-4-防御塔跟随目标朝向" class="headerlink" title="8.4 防御塔跟随目标朝向"></a>8.4 防御塔跟随目标朝向</h2><p>游戏中防御塔会跟随攻击目标旋转，这里使用的是Transform.LookAt()，但该函数在使用时会出现一个问题：<strong>由于塔与怪物不在同一层级上（深度不同），因此使用LookAt()函数会出现三维坐标上的旋转问题，投射到二维摄像机则会出现对象变形的情况。</strong>通过判定条件设置其x与y轴坐标即可修复。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;旋转</span><br><span class="line">        &#x2F;&#x2F;transform.LookAt(targetTrans);</span><br><span class="line">        if (targetTrans.gameObject.tag &#x3D;&#x3D; &quot;Item&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.LookAt(targetTrans.position + new Vector3(0, 0, 3));</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            transform.LookAt(targetTrans.position);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (transform.eulerAngles.y &#x3D;&#x3D; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.eulerAngles +&#x3D; new Vector3(0, 90, 0);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-总结"><a href="#9-总结" class="headerlink" title="9. 总结"></a>9. 总结</h1><p>游戏目前仍有一些不足点，例如：</p>
<ol>
<li>关卡少，还未设计其他关卡；</li>
<li>防御塔目前虽然有5种，但其攻击形式只有2种；</li>
<li>未实现游戏数据的存储功能；</li>
<li>未适配移动端的全面屏；</li>
<li>游戏的数值设计还不够科学。</li>
</ol>

        </div>
            
                    <ul class="post-copyright">
                    <li><strong>本文标题：</strong><a href="http://www.zanple.top/2020/05/13/unity-coviddefend/">Unity小游戏-新冠入侵</a></li>
                    <li><strong>本文作者：</strong><a href="http://www.zanple.top">Zanple</a></li>
                    <li><strong>本文链接：</strong><a href="http://www.zanple.top/2020/05/13/unity-coviddefend/">http://www.zanple.top/2020/05/13/unity-coviddefend/</a></li>
                    <li><strong>发布时间：</strong>2020-05-13</li>
                    <li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
                    </li>
                    </ul>
                
        
            <hr style="height:1px;margin:1rem 0"/>
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                        <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/Unity/" rel="tag">Unity</a>,&nbsp;<a class="has-link-grey -link" href="/tags/works/" rel="tag">works</a>,&nbsp;<a class="has-link-grey -link" href="/tags/%E6%B8%B8%E6%88%8F/" rel="tag">游戏</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/images/wechat.jpg" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2020/07/04/sd-embroidery/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Substance Designer-刺绣效果</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2020/04/27/unity-realtime-cyberpunk/">
                <span class="level-item">Unity实时渲染-赛博朋克风格场景</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="valine-thread" class="content"></div>
<script src="//unpkg.com/valine@1.4.14/dist/Valine.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: false,
        verify: false,
        app_id: 'vnCU1DBATElvGAC8uHCfuJCS-gzGzoHsz',
        app_key: 'neteGEzdBfz0C9UPU5tHdP7H',
        placeholder: '欢迎留下评论呀~'
    });
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/photo.png" alt="Zanple">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Zanple
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Student
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Guangzhou,Guangdong</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            37
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            19
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            43
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://zhihu.com/people/zanple/" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Zhihu" href="https://zhihu.com/people/zanple/">
                
                <i class="fab fa-zhihu"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="ArtStation" href="https://www.artstation.com/zanple/">
                
                <i class="fab fa-artstation"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Bilibili" href="https://space.bilibili.com/293017566">
                
                <i class="fab fa-bimobject"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/ZanpleLee/">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        

    <div class="card widget column-left is-sticky" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    目录
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#1-游戏简介">
        <!-- span class="has-mr-6">1</span-->
        <span>1. 游戏简介</span>
        </a></li><li>
        <a class="is-flex" href="#2-游戏需求与流程">
        <!-- span class="has-mr-6">2</span-->
        <span>2. 游戏需求与流程</span>
        </a></li><li>
        <a class="is-flex" href="#3-美术资源设计">
        <!-- span class="has-mr-6">3</span-->
        <span>3. 美术资源设计</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#3-1-按钮设计">
        <!-- span class="has-mr-6">3.1</span-->
        <span>3.1 按钮设计</span>
        </a></li><li>
        <a class="is-flex" href="#3-2-页面设计">
        <!-- span class="has-mr-6">3.2</span-->
        <span>3.2 页面设计</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#4-游戏设计模式与玩法机制">
        <!-- span class="has-mr-6">4</span-->
        <span>4. 游戏设计模式与玩法机制</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#4-1-设计模式">
        <!-- span class="has-mr-6">4.1</span-->
        <span>4.1 设计模式</span>
        </a></li><li>
        <a class="is-flex" href="#4-2-玩法机制">
        <!-- span class="has-mr-6">4.2</span-->
        <span>4.2 玩法机制</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#5-UML图">
        <!-- span class="has-mr-6">5</span-->
        <span>5. UML图</span>
        </a></li><li>
        <a class="is-flex" href="#6-UI部分技术总结">
        <!-- span class="has-mr-6">6</span-->
        <span>6. UI部分技术总结</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#6-1-DoTween插件的缓动函数">
        <!-- span class="has-mr-6">6.1</span-->
        <span>6.1 DoTween插件的缓动函数</span>
        </a></li><li>
        <a class="is-flex" href="#6-2-Scroll-Rect组件">
        <!-- span class="has-mr-6">6.2</span-->
        <span>6.2 Scroll Rect组件</span>
        </a></li><li>
        <a class="is-flex" href="#6-3-GridLayoutGroup组件">
        <!-- span class="has-mr-6">6.3</span-->
        <span>6.3 GridLayoutGroup组件</span>
        </a></li><li>
        <a class="is-flex" href="#6-4-翻页效果的实现思路">
        <!-- span class="has-mr-6">6.4</span-->
        <span>6.4 翻页效果的实现思路</span>
        </a></li><li>
        <a class="is-flex" href="#6-5-单页效果的实现">
        <!-- span class="has-mr-6">6.5</span-->
        <span>6.5 单页效果的实现</span>
        </a></li><li>
        <a class="is-flex" href="#6-6-多页效果的实现">
        <!-- span class="has-mr-6">6.6</span-->
        <span>6.6 多页效果的实现</span>
        </a></li><li>
        <a class="is-flex" href="#6-7-UI实例化">
        <!-- span class="has-mr-6">6.7</span-->
        <span>6.7 UI实例化</span>
        </a></li><li>
        <a class="is-flex" href="#6-8-克隆体名称问题与字符串截取">
        <!-- span class="has-mr-6">6.8</span-->
        <span>6.8 克隆体名称问题与字符串截取</span>
        </a></li><li>
        <a class="is-flex" href="#6-9-控制渲染顺序">
        <!-- span class="has-mr-6">6.9</span-->
        <span>6.9 控制渲染顺序</span>
        </a></li><li>
        <a class="is-flex" href="#6-10-主面板的左右移动动画">
        <!-- span class="has-mr-6">6.10</span-->
        <span>6.10 主面板的左右移动动画</span>
        </a></li><li>
        <a class="is-flex" href="#6-11-帮助面板的页面切换">
        <!-- span class="has-mr-6">6.11</span-->
        <span>6.11 帮助面板的页面切换</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#7-制图工具的实现">
        <!-- span class="has-mr-6">7</span-->
        <span>7. 制图工具的实现</span>
        </a></li><li>
        <a class="is-flex" href="#8-游戏主逻辑">
        <!-- span class="has-mr-6">8</span-->
        <span>8. 游戏主逻辑</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#8-1-产怪逻辑">
        <!-- span class="has-mr-6">8.1</span-->
        <span>8.1 产怪逻辑</span>
        </a></li><li>
        <a class="is-flex" href="#8-2-炮塔搜索目标的有关逻辑">
        <!-- span class="has-mr-6">8.2</span-->
        <span>8.2 炮塔搜索目标的有关逻辑</span>
        </a></li><li>
        <a class="is-flex" href="#8-3-建塔列表的优化">
        <!-- span class="has-mr-6">8.3</span-->
        <span>8.3 建塔列表的优化</span>
        </a></li><li>
        <a class="is-flex" href="#8-4-防御塔跟随目标朝向">
        <!-- span class="has-mr-6">8.4</span-->
        <span>8.4 防御塔跟随目标朝向</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#9-总结">
        <!-- span class="has-mr-6">9</span-->
        <span>9. 总结</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Unity小游戏-新冠入侵" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Zanple&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                <br> 
                <a class="has-link-black-ter-2 -link" href="http://beian.miit.gov.cn/" target="_blank">粤ICP备20031956号</a>
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://www.zanple.top',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>